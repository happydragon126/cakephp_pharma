(function(a,f){"function"===typeof define&&define.amd?define("jquery mooBehavior mooPhrase mooAjax mooGlobal mooTooltip mooAlert mooButton mooFileUploader tagsinput".split(" "),f):"object"===typeof exports?module.exports=f(require("jquery")):a.mooForum=f()})(this,function(a,f,d,h,n,p,g,e,q){var k=function(){a("#btn_search_topic").click(function(b){b.preventDefault();b=a("#keyword").val();if(""!=b){var c="";"#"==b[0]&&(c="/hashtag",b=b.substring(1));b=encodeURIComponent(encodeURIComponent(b));window.location=
    mooConfig.url.base+"/forums/topic/search/"+b+c}})},l=function(){a(".delete-topic").unbind("click");a(".delete-topic").click(function(){var b=a(this).data(),c=mooConfig.url.base+"/forums/topic/delete/"+b.id;"undefined"!=typeof b.topic&&(c+="/"+b.topic);mooConfig.isApp&&(c+="?app_no_tab=1");g.confirm(d.__("are_you_sure_you_want_to_remove_this_entry"),c)})},m=function(){a(".unpin-forum-topic").unbind("click");a(".unpin-forum-topic").click(function(){var b=a(this).data(),c=mooConfig.url.base+"/forum/forum_pins/unpin/"+
    b.id;"undefined"!=typeof b.topic&&(c+="/"+b.topic);mooConfig.isApp&&(c+="?app_no_tab=1");g.confirm(d.__("are_you_sure_you_want_to_unpin_this_topic"),c)})};return{initOnTopicListing:function(){k();a("#btn_index_search_topic").click(function(b){b.preventDefault();b=a("#search_keyword").val();""!=b&&(window.location=a("#form_index_search_topic").attr("action")+"/keyword:"+b)})},initOnViewTopic:function(){a(".btn_subscribe").unbind("click");a(".btn_subscribe").click(function(){var b=a(this).data();a.post(mooConfig.url.base+
        "/forums/topic/subscribe/"+b.id,function(b){b=a.parseJSON(b);"1"==b.result?(a(".btn_subscribe").html('<i class="material-icons">done</i>'+d.__("subscribed")),a(".btn_subscribe").addClass("active")):(a(".btn_subscribe").html('<i class="material-icons">rss_feed</i>'+d.__("subscribe")),a(".btn_subscribe").removeClass("active"));a(".btn_subscribe").spin(!1);e.enableButton("btn_subscribe")})});a(".btn_favorite").unbind("click");a(".btn_favorite").click(function(){var b=a(this).data();a.post(mooConfig.url.base+
        "/forums/topic/favorite/"+b.id,function(b){b=a.parseJSON(b);"1"==b.result?(a(".btn_favorite").addClass("active"),a(".btn_favorite .material-icons").html("star")):(a(".btn_favorite").removeClass("active"),a(".btn_favorite .material-icons").html("star_border"));a(".btn_favorite").spin(!1);e.enableButton("btn_favorite")})});a(".lock-topic").unbind("click");a(".lock-topic").click(function(){var b=a(this).data();a.post(mooConfig.url.base+"/forums/topic/lock/"+b.id,function(b){b=a.parseJSON(b);"1"==b.result?
        a(".lock-topic").html(d.__("lock")):"2"==b.result&&a(".lock-topic").html(d.__("open"));a(".lock-topic").spin(!1);e.enableButton("lock-topic")})});a("#btn_search_reply").click(function(b){b.preventDefault();window.location=a("#form_search_reply").attr("action")+"/keyword:"+a("#keyword").val()});l();m()},initAjaxInvite:function(){var b=new Bloodhound({datumTokenizer:function(a){return Bloodhound.tokenizers.whitespace(a.name)},queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:mooConfig.url.base+
                "/users/friends.json",cache:!1,filter:function(b){return a.map(b.data,function(a){return a})}},identify:function(a){return a.id}});b.initialize();a("#friends").tagsinput({freeInput:!1,itemValue:"id",itemText:"name",typeaheadjs:{name:"friends_userTagging",displayKey:"name",highlight:!0,limit:10,source:b.ttAdapter(),templates:{notFound:['<div class="empty-message">',d.__("no_results"),"</div>"].join(" "),suggestion:function(b){return""!=a("#friends").val()&&-1!=a("#friends").val().split(",").indexOf(b.id)?
                    '<div class="empty-message" style="display:none">'+d.__("no_results")+"</div>":['<div class="suggestion-item">','<img alt src="'+b.avatar+'"/>','<span class="text">'+b.name+"</span>","</div>"].join("")}}}});a("#sendButton").unbind("click");a("#sendButton").click(function(){a("#sendButton").spin("small");e.disableButton("sendButton");a(".error-message").hide();h.post({url:mooConfig.url.base+"/forums/topic/ajax_sendInvite",data:a("#sendInvite").serialize()},function(b){e.enableButton("sendButton");
        a("#sendButton").spin(!1);b=a.parseJSON(b);1==b.result?a("#simple-modal-body").html(b.msg):(a(".error-message").show(),a(".error-message").html(b.message))});return!1});a("#invite_type_topic").change(function(){a("#invite_friend").hide();a("#invite_email").hide();"1"==a("#invite_type_topic").val()?a("#invite_friend").show():a("#invite_email").show()})},initListReply:function(){a(".thank-topic").unbind("click");a(".thank-topic").click(function(){var b=a(this).data();a.post(mooConfig.url.base+"/forums/topic/ajax_thank/"+
        b.id+"/"+b.parent,function(c){c=a.parseJSON(c);a("#topic_thank_"+b.id).html(parseInt(c.thank_count));a(".btn-thank-"+b.id).toggleClass("active")})});a(".topic-get-link").unbind("click");a(".topic-get-link").click(function(){var b=a(this).data(),c=a("<input>");a("body").append(c);c.val(b.href).select();document.execCommand("copy");c.remove();g.alert(d.__("url_has_been_copied_to_clipboard"))})},initOnViewForum:function(){a("#btn_forum_search_topic").click(function(b){b.preventDefault();b=a("#keyword").val();
        var c="/keyword";"#"==b[0]&&(c="/hashtag",b=b.substring(1));window.location=a("#form_forum_search_topic").attr("action")+c+":"+b});a(".btn_subscribe").unbind("click");a(".btn_subscribe").click(function(){var b=a(this).data();a.post(mooConfig.url.base+"/forums/subscribe/"+b.id,function(b){b=a.parseJSON(b);"1"==b.result?(a(".btn_subscribe").html('<i class="material-icons">done</i>'+d.__("subscribed")),a(".btn_subscribe").addClass("active")):(a(".btn_subscribe").html('<i class="material-icons">rss_feed</i>'+
        d.__("subscribe")),a(".btn_subscribe").removeClass("active"));a(".btn_subscribe").spin(!1);e.enableButton("btn_subscribe")})});a("#btn_forum_locked").unbind("click");a("#btn_forum_locked").click(function(b){b.preventDefault();a.fn.SimpleModal({btn_ok:d.__("btn_ok"),callback:function(){},title:d.__("message"),contents:d.__("this_forum_is_marked_as_locked_for_new_topic"),model:"modal",hideFooter:!1,closeButton:!1}).showModal()})},initPinTopic:function(b){a("#pinTopicForm").submit(function(b){""==a("#time").val()?
        (b.preventDefault(),a(".error-message").show(),a(".error-message").html(d.__("day_required"))):a.isNumeric(a("#time").val())?a(".error-message").hide():(b.preventDefault(),a(".error-message").show(),a(".error-message").html(d.__("day_numeric")))});a("#time").on("keyup change",function(){var c=parseInt(a("#time").val());total=b*c;a("#pin_total").html(total)})},initSearchGlobal:k,initOnReport:function(){a("#forum_report_btn").unbind("click");a("#forum_report_btn").click(function(){e.disableButton("forum_report_btn");
        a("#forum_report_btn").spin("small");h.post({url:mooConfig.url.base+"/forum/forum_reports/ajax_save",data:a("#forum_report_form").serialize()},function(b){e.enableButton("forum_report_btn");a("#forum_report_btn").spin(!1);b=a.parseJSON(b);"1"==b.result?(a(".error-message").hide(),g.alert(b.message),a("#portlet-config").modal("hide"),a("#themeModal").modal("hide")):"2"==b.result?window.location=b.redirect:(a(".error-message").show(),a(".error-message").html(b.message))})});return!1}}});