(function(a,q){"function"===typeof define&&define.amd?define("jquery mooBehavior mooPhrase mooAjax mooGlobal mooTooltip mooAlert mooButton mooFileUploader tinyMCE tagsinput".split(" "),q):"object"===typeof exports?module.exports=q(require("jquery")):a.mooViewForum=q()})(this,function(a,q,k,r,m,v,w,x,n,f){function l(a,g){var c=a.indexOf(g);-1!==c&&a.splice(c,1);return a}function t(){setTimeout(function(){f.execCommand("mceFocus",!1,"description"+a(".topic_reply_button").data("id"))},1)}return{initReplyTopic:function(d,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         g){f.remove();f.init({selector:".forum-textarea",language:mooConfig.tinyMCE_language,theme:"modern",skin:"light",plugins:["advlist autolink lists link image charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code fullscreen","insertdatetime media nonbreaking save table contextmenu directionality","emoticons template paste textcolor"],toolbar1:"styleselect | bold italic | bullist numlist outdent indent | forecolor backcolor emoticons | link unlink anchor image media | preview fullscreen code | tagmember",
    image_advtab:!0,height:200,relative_urls:!1,remove_script_host:!1,document_base_url:"<?php echo FULL_BASE_URL . $this->request->root?>",setDirty:!0,hidden:!1,setup:function(b){b.addButton("tagmember",{tooltip:"Tag member",image:mooConfig.url.base+"/forum/img/user-64x64.png",onclick:function(){a.ajax({url:mooConfig.url.base+"/forums/topic/ajax_tag_member",success:function(b){a("#langModal .modal-content").html(b);a("#langModal").modal("show")}})}});b.on("focus",function(a){console.log("focus event",
        a)})}});a(".topic_reply_button").on("click",function(){var b=a(this).data();if(null!==f.activeEditor){var c=f.activeEditor.getContent();c=c.replace(/&nbsp;|<p>|<\/p>|<ul[^>]*>|<\/ul>|<li>|<\/li>|<ol[^>]*>|<\/ol>| /g,"").trim();c.length?a("#description"+b.id).val(f.activeEditor.getContent()):a("#description"+b.id).val("")}a(this).spin("small");a.post(mooConfig.url.base+"/forums/topic/save_reply/",a("#topicReplyForm"+b.id).serialize(),function(b){b=a.parseJSON(b);"1"==b.result?window.location=b.redirect:
    "2"==b.result?location.reload():(a(".forum-error-message").show(),a(".forum-error-message").html(b.message));a(".topic_reply_button").spin(!1)})});var c=[],h=[];a(".btn-delete-file").on("click",function(){a(this).spin("small");var b=a(this).data();a.post(mooConfig.url.base+"/forums/topic/delete_file/"+b.file+"/"+b.id,function(u){c=l(c,b.file);h=l(h,b.originalfile);a("#new_files_"+d).val(c.join(","));a("#new_original_files_"+d).val(h.join(","));a("#file_item_"+b.id).remove()})});if(""!=a("#new_files_"+
        d).val()&&""!=a("#new_original_files_"+d).val()){var p=a("#new_files_"+d).val();c=p.split(",");p=a("#new_original_files_"+d).val();h=p.split(",")}new n.fineUploader({element:a("#topic_file_upload_"+d)[0],text:{uploadButton:'<div class="upload-section"><i class="material-icons">photo_camera</i>'+k.__("drag_file")+"</div>"},validation:{allowedExtensions:g.split(","),sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+"/forums/topic/upload"},callbacks:{onError:m.errorHandler,onComplete:function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         u,e){jQuery.isEmptyObject(e)||(file=jQuery(this.getItemByFileId(b)),element_delete=a('<a href="javascript:void(0);" file="'+e.document_file+'" original-file="'+e.original_filename+'">'+k.__("delete")+"<a/>"),file.find(".qq-upload-status-text").append(element_delete),element_delete.click(function(){r.post({url:mooConfig.url.base+"/forums/topic/delete_file/"+a(this).attr("file")},function(a){});c=l(c,a(this).attr("file"));h=l(h,a(this).attr("original-file"));a("#new_files_"+d).val(c.join(","));a("#new_original_files_"+
    d).val(h.join(","));a(this).parent().parent().remove()}),c.push(e.document_file),h.push(e.original_filename),a("#new_files_"+d).val(c.join(",")),a("#new_original_files_"+d).val(h.join(",")),a("#nextStep").show())}}});var e=new n.fineUploader({element:a("#attachments_upload_"+d)[0],autoUpload:!1,text:{uploadButton:'<div class="upload-section"><i class="fa fa-file-text-o"></i>'+k.__("drag_photo")+" </div>"},validation:{allowedExtensions:["jpg","jpeg","gif","png"],sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+
"/forum/forum_upload/attachments/"},callbacks:{onError:m.errorHandler,onComplete:function(b,c,e){e.thumb&&(a("#forum_topic_photo_ids_"+d).val(a("#forum_topic_photo_ids_"+d).val()+","+e.photo_id),f.activeEditor.insertContent("[url="+e.large+"][img]"+e.thumb+"[/img][/url]"))}}});a("#triggerUpload_"+d).click(function(){e.uploadStoredFiles()});a("#toggleUploader_"+d).unbind("click");a("#toggleUploader_"+d).on("click",function(){a("#images-uploader-"+d).slideToggle()});a(".quote-reply").on("click",function(){a("html,body").animate({scrollTop:a("#post_reply_form").offset().top},
    "slow");var b=a(this).data();a.post(mooConfig.url.base+"/forums/topic/get_quote/"+b.id,function(b){b=a.parseJSON(b);f.activeEditor.insertContent(b.content);t()})});t()},initCreateTopic:function(d){f.init({selector:".forum-textarea",language:mooConfig.tinyMCE_language,theme:"modern",skin:"light",plugins:["advlist autolink lists link image charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code fullscreen","insertdatetime media nonbreaking save table contextmenu directionality",
    "emoticons template paste textcolor"],toolbar1:"styleselect | bold italic | bullist numlist outdent indent | forecolor backcolor emoticons | link unlink anchor image media | preview fullscreen code | tagmember",image_advtab:!0,height:200,relative_urls:!1,remove_script_host:!1,document_base_url:"<?php echo FULL_BASE_URL . $this->request->root?>",setup:function(c){c.addButton("tagmember",{tooltip:"Tag member",image:mooConfig.url.base+"/forum/img/user-64x64.png",onclick:function(){a.ajax({url:mooConfig.url.base+
"/forums/topic/ajax_tag_member",success:function(b){a("#langModal .modal-content").html(b);a("#langModal").modal("show")}})}});c.on("focus",function(a){console.log("focus event",a)})}});a("#button_save_topic").on("click",function(){var c=f.activeEditor.getContent();c=c.replace(/&nbsp;|<p>|<\/p>|<ul[^>]*>|<\/ul>|<li>|<\/li>|<ol[^>]*>|<\/ol>| /g,"").trim();c.length?a("#description").val(f.activeEditor.getContent()):a("#description").val("");a(this).spin("small");a.post(mooConfig.url.base+"/forums/topic/save/",
    a("#createTopicForm").serialize(),function(b){b=a.parseJSON(b);"1"==b.result?window.location=mooConfig.isApp?b.redirect+"?app_no_tab=1":b.redirect:(a(".error-message").show(),a(".error-message").html(b.message));a("#button_save_topic").spin(!1)})});var g=[],c=[];if(""!=a("#new_files").val()&&""!=a("#new_original_files").val()){var h=a("#new_files").val();g=h.split(",");h=a("#new_original_files").val();c=h.split(",")}a(".btn-delete-file").on("click",function(){a(this).spin("small");var e=a(this).data();
    a.post(mooConfig.url.base+"/forums/topic/delete_file/"+e.file+"/"+e.id,function(b){g=l(g,e.file);c=l(c,e.originalfile);a("#new_files").val(g.join(","));a("#new_original_files").val(c.join(","));a("#file_item_"+e.id).remove()})});new n.fineUploader({element:a("#topic_file_upload")[0],text:{uploadButton:'<div class="upload-section"><i class="material-icons">photo_camera</i>'+k.__("drag_file")+"</div>"},validation:{allowedExtensions:d.split(","),sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+
"/forums/topic/upload"},callbacks:{onError:m.errorHandler,onComplete:function(e,b,d){jQuery.isEmptyObject(d)||(file=jQuery(this.getItemByFileId(e)),element_delete=a('<a href="javascript:void(0);" file="'+d.document_file+'" original-file="'+d.original_filename+'">'+k.__("delete")+"<a/>"),file.find(".qq-upload-status-text").append(element_delete),element_delete.click(function(){r.post({url:mooConfig.url.base+"/forums/topic/delete_file/"+a(this).attr("file")},function(a){});g=l(g,a(this).attr("file"));
    c=l(c,a(this).attr("original-file"));a("#new_files").val(g.join(","));a("#new_original_files").val(c.join(","));a(this).parent().parent().remove()}),g.push(d.document_file),c.push(d.original_filename),a("#new_files").val(g.join(",")),a("#new_original_files").val(c.join(",")),a("#nextStep").show())}}});text_upload_button=""!=k.__("drag_photo")?'<div class="upload-section"><i class="material-icons">photo_camera</i>'+k.__("drag_photo")+"</div>":'<div class="upload-section"></div>';new n.fineUploader({element:a("#topic_thumnail")[0],
    multiple:!1,text:{uploadButton:text_upload_button},validation:{allowedExtensions:["jpg","jpeg","gif","png"],sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+"/forums/topic/upload_avatar"},callbacks:{onError:m.errorHandler,onComplete:function(c,b,d){a("#topic_thumnail_preview > img").attr("src",d.thumb);a("#topic_thumnail_preview > img").show();a("#thumb").val(d.file)}}});var p=new n.fineUploader({element:a("#attachments_upload")[0],autoUpload:!1,text:{uploadButton:'<div class="upload-section"><i class="fa fa-file-text-o"></i>'+
k.__("drag_photo")+" </div>"},validation:{allowedExtensions:["jpg","jpeg","gif","png"],sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+"/forum/forum_upload/attachments/"},callbacks:{onError:m.errorHandler,onComplete:function(c,b,d){d.thumb&&(a("#forum_topic_photo_ids").val(a("#forum_topic_photo_ids").val()+","+d.photo_id),f.activeEditor.insertContent("[url="+d.large+"][img]"+d.thumb+"[/img][/url]"))}}});a("#triggerUpload").click(function(){p.uploadStoredFiles()});a("#toggleUploader").unbind("click");
    a("#toggleUploader").on("click",function(){a("#images-uploader").slideToggle()})},initSignature:function(d){f.remove();f.init({selector:".forum-textarea",language:mooConfig.tinyMCE_language,theme:"modern",skin:"light",plugins:["advlist autolink lists link image charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code fullscreen","insertdatetime media nonbreaking save table contextmenu directionality","emoticons template paste textcolor"],toolbar1:"styleselect | bold italic | bullist numlist outdent indent | forecolor backcolor emoticons | link unlink anchor image media | preview fullscreen code",
    image_advtab:!0,height:200,relative_urls:!1,remove_script_host:!1,document_base_url:"<?php echo FULL_BASE_URL . $this->request->root?>"});a("#btn_signature").on("click",function(){var d=f.activeEditor.getContent();d=d.replace(/&nbsp;|<p>|<\/p>/g,"").trim();d.length?a("#signature").val(f.activeEditor.getContent()):a("#signature").val("");a(this).spin("small");a.post(mooConfig.url.base+"/forums/topic/signature/",a("#formSignature").serialize(),function(c){c=a.parseJSON(c);"1"==c.result?a("#msg_success").show():
    (a("#msg_success").hide(),a(".error-message").show(),a(".error-message").html(c.message));a("#btn_signature").spin(!1)})})}}});