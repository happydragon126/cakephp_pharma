!function(e,n){"function"==typeof define&&define.amd?define(["jquery","mooButton","mooOverlay","mooResponsive","mooAjax","mooAlert","spinner"],n):"object"==typeof exports?module.exports=n(require("jquery"),require("button")):e.mooBehavior=n()}(this,function(e,n,i,t,o,r){var a=!0,l=function(){e(".view-more .viewMoreBtn").unbind("click"),e(".view-more .viewMoreBtn").click(function(){var n=e(this).data();c(n.url,n.div,this)}),e(".view-more-chrono .viewMoreBtn").unbind("click"),e(".view-more-chrono .viewMoreBtn").click(function(){var n=e(this).data();d(n.url,n.div,this)})},s=function(){e(".view-more .viewMoreBtn").unbind("click"),e(".view-more .viewMoreBtn").click(function(){var n=e(this).data();m(n.url,n.div,this)})},m=function(n,i,t){e(t).spin("small"),e(t).parent().css("display","none"),e.post(mooConfig.url.base+n,"",function(n){e(t).spin(!1),e("#"+i).find(".view-more:first").remove(),e("#"+i).children(".clear:first").remove(),e("#"+i).find(".loading:first").remove(),e("#"+i).append(n),s()})},c=function(n,o,r){e(r).spin("small"),e(r).parent().css("display","none"),void 0===window.searchParams&&(window.searchParams=""),e.post(mooConfig.url.base+n,window.searchParams,function(n){e(r).spin(!1),e("#"+o).find(".view-more:first").remove(),e("#"+o).children(".clear:first").remove(),e("#"+o).find(".loading:first").remove(),a=!0,"comments"==o||"theaterComments"==o?(e("#"+o).append(n),e("#"+o+" .view-more").insertAfter("#"+o+' li[id^="itemcomment_"]:last')):e("#"+o).append(n),i.registerOverlay(),u(),e(".tip").tipsy({html:!0,gravity:"s"}),window.initShareBtn(),t.initFeedImage(),componentHandler.upgradeAllRegistered(),l()})},d=function(n,o,r){e(r).spin("small"),e(r).parent().css("display","none"),void 0===window.searchParams&&(window.searchParams=""),e.post(mooConfig.url.base+n,window.searchParams,function(n){e(r).spin(!1),e("#"+o).find(".view-more:first").remove(),e("#"+o).children(".clear:first").remove(),e("#"+o).find(".loading:first").remove(),a=!0,"comments"==o||"theaterComments"==o?(e("#"+o).prepend(n),e("#"+o+" .view-more").insertAfter("#"+o+' li[id^="itemcomment_"]:last')):e("#"+o).prepend(n),i.registerOverlay(),u(),e(".tip").tipsy({html:!0,gravity:"s"}),window.initShareBtn(),t.initFeedImage(),componentHandler.upgradeAllRegistered(),l()})},u=function(){e(".comment_thumb a").length&&e(".comment_thumb a").magnificPopup({type:"image",gallery:{enabled:!1},zoom:{enabled:!0,opener:function(e){return e}}})},g=[];function f(n){var i=mooConfig.FeedPluginConfig[n];0!=i.length&&e("body").trigger("enablePluginsCallback",[{plugins:i}])}function p(n){var i=mooConfig.FeedPluginConfig[n];0!=i.length&&e("body").trigger("disablePluginsCallback",[{plugins:i}])}function v(){if(0!=g.length)for(var e=0;e<g.length;e++)p(g[e])}return{initAutoLoadMore:function(){""!=mooConfig.autoLoadMore&&e(window).scroll(function(){var n=e(".view-more");if(n.length>0){var i=e(window),t=i.scrollTop(),o=t+i.height(),r=n.offset().top;r+n.height()<=o&&r>=t&&a&&(n.before('<div style="text-align: center" class="loading"><img src="'+mooConfig.url.base+'/img/loading.gif" /></div>'),n.find("a").trigger("click"),a=!1)}})},createItem:function(i,t){n.disableButton("saveBtn");var r="ajax_save";t&&(r="save"),o.post({url:mooConfig.url.base+"/"+i+"/"+r,data:e("#createForm").serialize()},function(t){var o=e.parseJSON(t);1==o.result?window.location=mooConfig.url.base+"/"+i+"/view/"+o.id:(n.enableButton("saveBtn"),e(".error-message").show(),e(".error-message").html(o.message),e(".spinner").length>0&&e(".spinner").remove())})},initMoreResults:l,initMoreResultsPopup:s,toggleCheckboxes:function(n){n.checked?e(".check").attr("checked","checked"):e(".check").attr("checked",!1)},toggleMenu:function(n){"leftnav"==n?"-200px"==e("#leftnav").css("left")?(e("#leftnav").animate({left:0},300),e("#right").animate({right:-204},300),e("#center").animate({left:200},300)):(e("#leftnav").animate({left:-200},300),e("#center").animate({left:0},300)):"-204px"==e("#right").css("right")?(e("#right").show(),e("#right").animate({right:0},300),e("#leftnav").animate({left:-200},300),e("#center").animate({left:0},300)):e("#right").animate({right:-204},300,function(){e("#right").hide()})},registerImageComment:u,initOnReportItem:function(){return e("#reportButton").unbind("click"),e("#reportButton").click(function(){n.disableButton("reportButton"),e("#reportButton").spin("small"),o.post({url:mooConfig.url.base+"/reports/ajax_save",data:e("#reportForm").serialize()},function(i){n.enableButton("reportButton"),e("#reportButton").spin(!1);var t=e.parseJSON(i);1==t.result?(e(".error-message").hide(),e(".mdl-textfield__input").val(""),e(".autogrow-textarea-mirror").val(""),r.alert(t.message),e("#portlet-config").modal("hide"),e("#themeModal").modal("hide")):(e(".error-message").show(),e(".error-message").html(t.message))})}),!1},initFeedForm:function(){e("body").on("startFeedPlugin3drCallback",function(n,i){-1==g.indexOf(i.plugin_name)&&(g.push(i.plugin_name),p(i.plugin_name),e("body").trigger("listFeedPlugin3drEnableCallback",[{plugins:g}]))}),e("body").on("stopFeedPlugin3drCallback",function(n,i){var t=g.indexOf(i.plugin_name);t>-1&&(f(i.plugin_name),g.splice(t,1),v(),e("body").trigger("listFeedPlugin3drEnableCallback",[{plugins:g}]))}),e("body").on("refreshFeedPlugin3drCallback",function(e,n){var i=g.indexOf(n.plugin_name);"add"===n.status?-1==i&&(g.push(n.plugin_name),p(n.plugin_name)):"remove"===n.status&&i>-1&&(g.splice(i,1),f(n.plugin_name),v())})}}});