!function(t,e){"function"==typeof define&&define.amd?define(["jquery","mooPhrase","mooBehavior","mooMention","mooEmoji","mooFileUploader","mooUser","mooButton","mooGlobal","mooResponsive","mooAttach","mooComment","mooLike","autogrow","spinner"],e):"object"==typeof exports?module.exports=e(require("jquery")):t.mooActivities=e()}(this,function(t,e,i,o,n,a,c,m,l,s,d,r,_){var v={},u=function(i,o){t.fn.SimpleModal({btn_ok:e.__("confirm"),btn_cancel:e.__("cancel"),callback:function(){t.post(mooConfig.url.base+"/activities/ajax_remove_tags",{item_id:i,item_type:o},function(){window.location.reload()})},title:e.__("remove_tags"),contents:e.__("remove_tags_contents"),model:"confirm",hideFooter:!1,closeButton:!1}).showModal()},f=function(e){t("#comments_"+e+" .hidden").fadeIn(),t("#comments_"+e+" .hidden").attr("class",""),t("#all_comments_"+e).hide()},p=function(){t(".removeActivity").unbind("click"),t(".removeActivity").click(function(){var i,o=t(this).data();i=o.activityId,t.fn.SimpleModal({btn_ok:e.__("ok"),btn_cancel:e.__("cancel"),callback:function(){t.post(mooConfig.url.base+"/activities/ajax_remove",{id:i},function(){t("#activity_"+i).fadeOut("normal",function(){t("#activity_"+i).remove()})})},title:e.__("please_confirm"),contents:e.__("please_confirm_remove_this_activity"),model:"confirm",hideFooter:!1,closeButton:!1}).showModal()})},g=[],h=function(e){0==t("#activity_edit_"+e).length&&t.post(mooConfig.url.base+"/activities/ajax_loadActivityEdit/"+e,function(i){t("#activity_feed_content_text_"+e+" .comment_message").hide(),t(i).insertAfter(t("#activity_feed_content_text_"+e+" .comment_message")),g.push(e),k(),o.init(t(i).find("textarea").attr("id"),"edit_activity"),n.init(t(i).find("textarea").attr("id"))})},y=function(e){t("#message_edit_"+e).siblings(".textoverlay")&&t("#message_edit_"+e).destroyOverlayInstance(t("#message_edit_"+e)),t("#activity_feed_content_text_"+e+" .comment_message").show(),t("#activity_edit_"+e).remove();var i=t.inArray(e,g);g.splice(i,1)},b=function(e){var i;""!=t.trim(t("#message_edit_"+e).val())&&(i=0!=t("#message_edit_"+e+"_hidden").length?t("#message_edit_"+e+"_hidden").val():t("#message_edit_"+e).val(),t.post(mooConfig.url.base+"/activities/ajax_editActivity/"+e,{message:i},function(i){t("#message_edit_"+e).siblings(".textoverlay")&&t("#message_edit_"+e).destroyOverlayInstance(t("#message_edit_"+e)),t("#activity_feed_content_text_"+e+" .comment_message").html(t(i).html()),t("#history_activity_"+e).show(),y(e)}))},w=function(e,o){"1"===mooConfig.comment_sort_style?t("#newComment_"+e).before(o):t("#newComment_"+e).after(o),t(".slide").slideDown(),t("#commentButton_"+e+" a").removeClass("disabled"),t("#commentButton_"+e+" a i").remove(),t("#commentForm_"+e).val(""),t(".commentBox").css("height","27px"),t("#comment_preview_image_"+e).html(""),t("#comment_image_"+e).val(""),t("#comment_button_attach_"+e).show(),i.registerImageComment(),k()},k=function(n){t("textarea:not(.no-grow)").autogrow(),void 0!==typeof v&&(v=n),t(".removeTags").unbind("click"),t(".removeTags").click(function(){var e=t(this).data();u(e.activityId,e.activityItemType)}),t(".editActivity").unbind("click"),t(".editActivity").click(function(){var e=t(this).data();h(e.activityId)}),p(),r.initEditActivityComment(),r.initRemoveActivityComment(),r.initRemoveItemComment(),t("body").off("click.activity","a.admin-or-owner-confirm-delete-photo-comment").on("click.activity","a.admin-or-owner-confirm-delete-photo-comment",function(){var i,o=t(this).data();void 0!==typeof o.commentId&&(i=o.commentId,t.fn.SimpleModal({btn_ok:e.__("ok"),btn_cancel:e.__("cancel"),callback:function(){t.post(mooConfig.url.base+"/comments/ajax_remove",{id:i},function(){t("#photo_comment_"+i).fadeOut("normal",function(){t("#photo_comment_"+i).remove()})})},title:e.__("please_confirm"),contents:e.__("please_confirm_remove_this_activity"),model:"confirm",hideFooter:!1,closeButton:!1}).showModal())}),t("body").off("click.activity","a.viewer-submit-comment").on("click.activity","a.viewer-submit-comment",function(){var e=t(this).data();void 0!==typeof e.activityId&&function(e){if(""!=t.trim(t("#commentForm_"+e).val())||""!=t("#comment_image_"+e).val()){t("#commentButton_"+e+" a").addClass("disabled"),t("#commentButton_"+e+" a").prepend('<i class="icon-refresh icon-spin"></i>');var i=t("#commentForm_"+e).siblings("input.messageHidden").length>0?t("#commentForm_"+e).siblings("input.messageHidden").val():t("#commentForm_"+e).val();t.post(mooConfig.url.base+"/activities/ajax_comment",{activity_id:e,thumbnail:t("#comment_image_"+e).val(),comment:i},function(i){if(""!=i){w(e,i);var n=t("#commentForm_"+e);o.resetMention(n),componentHandler.upgradeAllRegistered()}})}}(e.activityId)}),t("body").off("click.activity","a.viewer-submit-item-comment").on("click.activity","a.viewer-submit-item-comment",function(){var e=t(this).data();void 0!==typeof e.itemType&&void 0!==typeof e.activityItemId&&void 0!==typeof e.activityId&&function(e,i,n){if(""!=t.trim(t("#commentForm_"+n).val())||""!=t("#comment_image_"+n).val()){t("#commentButton_"+n+" a").prepend('<i class="icon-refresh icon-spin"></i>'),t("#commentButton_"+n+" a").addClass("disabled");var a="";a=t("#commentForm_"+n).siblings(".messageHidden").length>0?t("#commentForm_"+n).siblings(".messageHidden").val():t("#commentForm_"+n).val(),t.post(mooConfig.url.base+"/comments/ajax_share",{type:e,target_id:i,thumbnail:t("#comment_image_"+n).val(),message:a,activity:1},function(e){if(""!=e){w(n,e);var i=t("#commentForm_"+n);o.resetMention(i),componentHandler.upgradeAllRegistered()}})}}(e.itemType,e.activityItemId,e.activityId)}),t("body").off("click.activity","a.change-activity-privacy").on("click.activity","a.change-activity-privacy",function(){var e,i,o,n=t(this).data();void 0!==typeof n.activityId&&void 0!==typeof n.privacy&&(e=t(this),i=n.activityId,o=n.privacy,t.post(mooConfig.url.base+"/activities/ajax_changeActivityPrivacy/",{activityId:i,privacy:o},function(t){if(""!=t){var o;switch((t=JSON.parse(t)).icon){case"icon-globe-1":o="public";break;case"icon-users-1":o="people";break;case"icon-lock-1":o="lock"}var n=e.parents(".dropdown");n.find("a#permission_"+i).attr("original-title",t.text),n.find("a#permission_"+i+" i").html(o),n.find(".dropdown-menu li a").removeClass("n52"),e.addClass("n52")}}))}),r.initShowCommentForm(),_.initLikeActivity(),r.initRemoveItemComment(),r.initEditItemComment(),r.initShowCommentBtn(),t(".showAllComments").unbind("click"),t(".showAllComments").on("click",function(){var e=t(this).data();f(e.id)}),i.initMoreResults(),componentHandler.upgradeAllRegistered()},C=function(){if(!c.validateUser())return!1;var i=t("#message").val();""!=t.trim(i)||t("#video_destination").length>0&&""!==t("#video_destination").val()||""!=t("#wall_photo_preview :not(#addMoreImage)").html()&&"add"!=t("#wall_photo_preview :not(#addMoreImage)").html()?(m.disableButton("status_btn"),t("#status_btn").spin("small"),t.post(mooConfig.url.base+"/activities/ajax_share",t("#wallForm").serialize(),function(i){if(t("#status_btn").hasClass("call_back_app"))t("#video_destination").length>0&&""!==t("#video_destination").val()?(t("#status_btn").spin(!1),t.fn.SimpleModal({model:"content",title:e.__("upload_video_phrase_4"),contents:e.__("upload_video_phrase_0"),onAppend:function(){var i=t("<a>").attr({title:e.__("btn_ok"),class:"mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--raised mdl-button--colored"}).click(function(){window.mobileAction.backOnly()}).text(e.__("btn_ok"));t("#simple-modal").find(".simple-modal-footer").append(i)}}).showModal()):window.mobileAction.backOnly();else{if(t("#wall_photo").val(""),m.enableButton("status_btn"),t("#message").val(""),t("#video_destination").length>0&&""!==t("#video_destination").val())t.fn.SimpleModal({model:"content",title:e.__("upload_video_phrase_4"),contents:e.__("upload_video_phrase_0")}).showModal(),setTimeout(function(){t("#simpleModal").hideModal()},3e3);else if(""!=i){t(".no-feed").length>0&&t("#list-content .no-feed").remove(),t("#list-content").prepend(i),t("#message").css("height","36px"),t(".slide").slideDown(),t("#wall_photo_preview span:not(.addMoreImage)").remove(),t("#addMoreImage").hide(),t(".form-feed-holder").css("padding-bottom","0px");var n=t(i).find("div[id^=comment_button_attach_]").data("id");d.registerAttachComment(n)}t("#status_btn").spin(!1),s.init(),t(".tip").tipsy({html:!0,gravity:"s"}),t('[data-toggle="tooltip"]').tooltip();var a=t("#wallForm").find("#message");o.resetMention(a),t("body").trigger("afterPostWallCallbackSuccess",[])}}),t(".stt-action .userTagging-userTagging").addClass("hidden"),t(".stt-action").css("margin-top","0"),t("#wall_photo_preview").hide(),t("#userTagging").tagsinput("removeAll")):t.fn.SimpleModal({btn_ok:e.__("btn_ok"),btn_cancel:e.__("cancel"),model:"modal",title:e.__("warning"),contents:e.__("share_whats_new_can_not_empty")}).showModal()};return{init:k,initActivityForm:function(){t('[data-toggle="tooltip"]').tooltip();new a.fineUploader({element:t("#select-2")[0],text:{uploadButton:'<div class="upload-section"><span class=" mdl-button mdl-js-button mdl-button--icon"><i class="material-icons">local_see</i></span></div>'},validation:{allowedExtensions:mooConfig.photoExt,sizeLimit:mooConfig.sizeLimit},multiple:!0,request:{endpoint:mooConfig.url.base+"/upload/wall"},callbacks:{onError:l.errorHandler,onSubmit:function(e,i){t('<span id="feed_'+e+'" style="background-image:url('+mooConfig.url.base+'/img/indicator.gif);background-size:inherit;background-repeat:no-repeat"></span>').insertBefore(".addMoreImage"),t("#wall_photo_preview").show(),t("#addMoreImage").show()},onComplete:function(e,i,o,n){if(o.success){t('[data-toggle="tooltip"]').tooltip("hide"),t(this.getItemByFileId(e)).remove(),t('<img src="'+o.file_path+'">').load(function(){var i=t("#feed_"+e);i.attr("style","background-image:url("+o.file_path+")");var n=t('<a href="javascript:void(0);"><i class="material-icons thumb-review-delete">clear</i></a>');i.append(n),i.find(".thumb-review-delete").unbind("click"),i.find(".thumb-review-delete").click(function(e){e.preventDefault(),t(this).parents("span").remove(),t("#wall_photo").val(t("#wall_photo").val().replace(o.photo+",","")),t("body").trigger("afterDeleteWallPhotoCallback",[o])})});var a=t("#wall_photo").val();t("#wall_photo").val(a+o.photo+","),t("body").trigger("afterUploadWallPhotoCallback",[o])}}}});t("#addMoreImage").unbind("click"),t("#addMoreImage").click(function(){t("#select-2 input[name=file]").click()}),t("#message").on("focus",function(){r.showCommentButton(0)}),t("#status_btn").unbind("click"),t("#status_btn").click(function(){C()}),t("#status_box").slideDown("slow"),i.initFeedForm()},initOnAjaxLoadActivityEdit:function(){t(".cancelEditActivity").unbind("click"),t(".cancelEditActivity").click(function(){var e=t(this).data();y(e.activityId)}),t(".confirmEditActivity").unbind("click"),t(".confirmEditActivity").click(function(){var e=t(this).data();b(e.activityId)})}}});