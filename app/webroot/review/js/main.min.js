(function(a,e){"function"===typeof define&&define.amd?define("jquery mooBehavior mooButton mooFileUploader mooAjax mooAlert mooPhrase mooGlobal mooTooltip mooReviewRating".split(" "),e):"object"===typeof exports?module.exports=e(require("jquery")):a.mooReview=e()})(this,function(a,e,h,l,m,n,d,p,q){var g=function(b){var c=a('input[type="number"][class^="rating"]');c.length&&c.rating("refresh",{disabled:b,showCaption:!1,showClear:!1,step:1,max:5})},t=function(){992>a(window).width()&&(a("#right").modal("hide"),
a("body").scrollTop(0));g(!1);var b=new l.fineUploader({element:a("#attachments_upload")[0],autoUpload:!1,text:{uploadButton:'<div class="upload-section"><i class="material-icons">photo_camera</i>'+d.__("drag_or_click_here_to_upload_photo")+"</div>"},validation:{allowedExtensions:mooConfig.photoExt,sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+"/reviews/attachments"},callbacks:{onError:p.errorHandler,onComplete:function(b,f,d){d.filename?0<a("#attachments").length&&(b=a("#attachments").val(),
""===b?a("#attachments").val(d.photo):a("#attachments").val(b+","+d.photo)):0===d.result&&n.alert(d.message)}}});a("#triggerUpload").click(function(){b.uploadStoredFiles()});a(".removePhoto").unbind("click");a(".removePhoto").click(function(){var b=a(this).data(),f=a("#attachments_remain").val();f=""===f?[]:f.split(",");-1!==a.inArray(b.id.toString(),f)&&f.splice(f.indexOf(b.id.toString()),1);a(this).closest("li").remove();a("#attachments_remain").val(f.join())});a("#reviewBtn").unbind("click");a("#reviewBtn").click(function(){h.disableButton("reviewBtn");
a("#reviewBtn").spin("tiny");m.post({url:mooConfig.url.base+"/reviews/save",data:a("#reviewForm").serialize()},function(b){b=a.parseJSON(b);1===b.result?(mooConfig.isApp&&window.location.reload(),a("#themeModal").modal("hide"),a("#reloadReviewWidget").trigger("click"),a(".browseReviews").length?"reviewed"===b.type?a("#reviewedReviewProfile").trigger("click"):a("#userReviewProfile").trigger("click"):a("#reviewProfile").trigger("click"),992>a(window).width()&&(a("#right").modal("hide"),a("body").scrollTop(0))):
(a("#reviewBtn").spin(!1),h.enableButton("reviewBtn"),a(".error-message").show(),a(".error-message").html(b.message))})})},y=function(){u();q.init();v();w();x();g(!0);e.initMoreResults();e.initAutoLoadMore();a(".browseReviews a").unbind("click");a(".browseReviews a").click(function(){var b=a(this);b.spin("tiny");b.parent().is("li")&&(a(".browseReviews .current").removeClass("current"),b.parent().addClass("current"));var c=b.attr("rel");void 0===c&&(c="list-content");a("#"+c).load(b.attr("data-url")+
"?"+a.now(),function(c){try{a.parseJSON(c).data}catch(r){c}b.spin(!1);window.history.pushState({},"",b.attr("href"));992>a(window).width()&&(a("#leftnav").modal("hide"),a("body").scrollTop(0))});return!1})},z=function(){var b=a("#reviewDetail"),c=a("#reviewProfile");0<b.length&&(c.spin("tiny"),c.children(".badge_counter").hide(),a("#browse .current").removeClass("current"),c.parent().addClass("current"),a("#profile-content").load(b.attr("data-url")+"?"+a.now(),function(b){try{a.parseJSON(b).data}catch(r){b}c.spin(!1);
c.children(".badge_counter").fadeIn();992>a(window).width()&&(a("#leftnav").modal("hide"),a("body").scrollTop(0))}))},A=function(){var b=a("#reviewProfile");0<b.length&&(b.spin("tiny"),b.children(".badge_counter").hide(),a("#browse .current").removeClass("current"),b.parent().addClass("current"),a("#profile-content").load(b.attr("data-url")+"?"+a.now(),function(c){try{a.parseJSON(c).data}catch(f){c}b.spin(!1);b.children(".badge_counter").fadeIn();992>a(window).width()&&(a("#leftnav").modal("hide"),
a("body").scrollTop(0))}))},v=function(){a(".loadModalContent").unbind("click");a(".loadModalContent").click(function(){var b=a(this).data();a("#themeModal .modal-content").html("");a("#themeModal .modal-content").spin("small");a("#themeModal .modal-content").load(b.url,function(){a("#themeModal .modal-content").spin(!1);a("#themeModal").modal("show")})})},w=function(){a(".deleteReview").unbind("click");a(".deleteReview").click(function(){var b=a(this).data(),c="btn btn-action";mooConfig.isApp&&(c=
"mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--raised mdl-button--colored1");a.fn.SimpleModal({callback:function(){a.post(mooConfig.url.base+"/reviews/delete",{id:b.id,noCache:1},function(){mooConfig.isApp?window.location.reload():(a(".browseReviews").length?"reviewed"===b.type?a("#reviewedReviewProfile").trigger("click"):a("#userReviewProfile").trigger("click"):a("#reviewProfile").trigger("click"),a("#reloadReviewWidget").trigger("click"))})},model:"content",title:d.__("please_confirm"),
contents:'<div style="margin-bottom: 10px">'+d.__("review_are_you_sure_you_want_to_remove_this_"+b["delete"])+"</div>",onAppend:function(){var b=this,e=a("<a>").attr({title:d.__("btn_ok"),"class":c}).click(function(){b.options.callback();b.hideModal()}).text(d.__("btn_ok")),g=a("<a>").attr({title:d.__("btn_ok"),"class":"button"}).click(function(){b.hideModal()}).text(d.__("review_cancel"));a("#simple-modal").find(".simple-modal-footer").append(e).append(g)}}).showModal()})},x=function(){a("#enableReview").unbind("click");
a("#enableReview").click(function(){var b=a(this).data(),c="btn btn-action";mooConfig.isApp&&(c="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--raised mdl-button--colored1");a.fn.SimpleModal({callback:function(){a.post(mooConfig.url.base+"/reviews/enable",{noCache:1},function(){window.location.reload()})},model:"content",title:d.__("please_confirm"),contents:'<div style="margin-bottom: 10px">'+d.__("review_are_you_sure_you_want_to_"+b.review+"_rating")+"</div>",onAppend:function(){var b=
this,e=a("<a>").attr({title:d.__("btn_ok"),"class":c}).click(function(){b.options.callback();b.hideModal()}).text(d.__("btn_ok")),g=a("<a>").attr({title:d.__("btn_ok"),"class":"button"}).click(function(){b.hideModal()}).text(d.__("review_cancel"));a("#simple-modal").find(".simple-modal-footer").append(e).append(g)}}).showModal()})},C=function(){B();g(!0);a("#reviewProfileWidget").unbind("click");a("#reviewProfileWidget").click(function(){a("#reviewProfile").trigger("click");992>a(window).width()&&
(a("#right").modal("hide"),a("body").scrollTop(0))})},B=function(){a("#reloadReviewWidget").unbind("click");a("#reloadReviewWidget").click(function(){a("#reviewWidgetContent").load(a("#reloadReviewWidget").attr("data-url")+"?"+a.now(),function(b){try{a.parseJSON(b).data}catch(c){b}992>a(window).width()&&(a("#right").modal("hide"),a("body").scrollTop(0))})})},u=function(){a(".review-truncate").each(function(){if(45<=parseInt(a(this).css("height"))){var b=a('<a href="javascript:void(0)" class="show-more">'+
a(this).data("more-text")+"</a>");a(this).after(b);b.click(function(a){k(this)})}})},k=function(b){a(b).prev().css("max-height","none");var c=a('<a href="javascript:void(0)" class="show-more">'+a(b).prev().data("less-text")+"</a>");a(b).replaceWith(c);c.click(function(a){D(this)})},D=function(b){a(b).prev().css("max-height","");var c=a('<a href="javascript:void(0)" class="show-more">'+a(b).prev().data("more-text")+"</a>");a(b).replaceWith(c);c.click(function(a){k(this)})};return{initWidgetReview:function(){C()},
initOnViewAppProfile:function(){0===a("#profile-content").length&&a("#profile-content-wrap").wrapAll('<div id="profile-content" />')},initReviewProfile:function(){A()},initReviewDetail:function(){z()},initBrowseReview:function(){y()},initWriteReview:function(){t()},initReviewStar:function(){g()}}});