(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","mooPhrase","mooMention","mooEmoji","mooAttach","mooBehavior","mooLike","mooTooltip","autogrow","overlay"],b)}else{if(typeof exports==="object"){module.exports=b(require("jquery"))}else{a.mooComment=b()}}}(this,function(u,i,K,s,h,q,k,f){var j=[];var I=[];var w=false;var C=function(){u(".showCommentBtn").unbind("onfocus");u(".showCommentBtn").on("focus",function(){var M=u(this).data();d(M.id)})};var v=function(){u(".showCommentForm").unbind("click");u(".showCommentForm").click(function(){var M=u(this).data();g(M.id)})};var A=function(){u("#comments li").hover(function(){u(this).contents(".cross-icon").show()},function(){u(this).contents(".cross-icon").hide()});q.initMoreResults();k.initLikeActivity();t();p()};var a=function(){C();u(".shareButton").unbind("click");u(".shareButton").click(function(){var M=u(this).data();y(M.id)})};var t=function(){u(".removeItemComment").unbind("click");u(".removeItemComment").click(function(){var M=u(this).data();D(M.id,M.photoComment)})};var p=function(){u(".editItemComment").unbind("click");u(".editItemComment").click(function(){var M=u(this).data();J(M.id,M.photoComment)})};var F=function(){u(".removeActivityComment").unbind("click");u(".removeActivityComment").click(function(){var M=u(this).data();B(M.activityCommentId)})};var o=function(){u(".editActivityComment").unbind("click");u(".editActivityComment").click(function(){var M=u(this).data();L(M.activityCommentId)})};var L=function(M){if(u("#activity_comment_edit_"+M).length==0){u.post(mooConfig.url.base+"/activities/ajax_loadActivityCommentEdit/"+M,function(N){u("#activity_feed_comment_text_"+M).hide();u(N).insertAfter(u("#activity_feed_comment_text_"+M));h.registerAttachCommentEdit("activity",M);j.push(M);u("textarea:not(.no-grow)").autogrow();K.init(u(N).find("textarea").attr("id"),"edit_activity");s.init(u(N).find("textarea").attr("id"),"edit_activity");u("body").trigger("afterShowFormEditCommentCallback",[])})}};var B=function(M){u.fn.SimpleModal({btn_ok:i.__("btn_ok"),btn_cancel:i.__("cancel"),callback:function(){u.post(mooConfig.url.base+"/activities/ajax_removeComment",{id:M},function(){u("#comment_"+M).fadeOut("normal",function(){u("#comment_"+M).remove();u("body").trigger("afterRemoveActivityCommentCallback",[])})})},title:i.__("please_confirm"),contents:i.__("please_confirm_remove_this_activity"),model:"confirm",hideFooter:false,closeButton:false}).showModal()};var E=function(){u("textarea:not(.no-grow)").autogrow();r();x();H()};var m=function(){b();e();H()};var H=function(){u(".removePhotoComment").unbind("click");u(".removePhotoComment").on("click",function(){var M=u(this).data();n(M.type,M.id)})};var b=function(){u(".cancelEditActivityComment").unbind("click");u(".cancelEditActivityComment").click(function(){var M=u(this).data();z(M.id)})};var e=function(){u(".confirmEditActivityComment").unbind("click");u(".confirmEditActivityComment").click(function(){var M=u(this).data();G(M.id)})};var r=function(){u(".cancelEditItemComment").unbind("click");u(".cancelEditItemComment").click(function(){var M=u(this).data();l(M.id,M.photoComment)})};var x=function(){u(".confirmEditItemComment").unbind("click");u(".confirmEditItemComment").click(function(){var M=u(this).data();c(M.id,M.photoComment)})};var y=function(N){if(u.trim(u("#postComment").val())!=""||u.trim(u("#theaterPhotoComment").val())!=""||u("#comment_image_"+N).val()!=""){if(mooConfig.comment_sort_style==="1"){u(".shareButton").addClass("disabled");u(".shareButton").append('<i class="icon-refresh icon-spin"></i>');var M="";if(u("#commentForm").length){M=u("#commentForm").serialize()}if(u("#theaterPhotoCommentForm").length){M=u("#theaterPhotoCommentForm").serialize()}u.post(mooConfig.url.base+"/comments/ajax_share",M,function(P){u(".shareButton").removeClass("disabled");u(".shareButton i").remove();u(".commentForm").css("height","35px");if(u("#postComment").length){u("#postComment").val("")}if(u("#theaterPhotoComment").length){u("#theaterPhotoComment").val("")}if(P!=""){if(u("#theaterComments").length){u("#theaterComments").append(P)}else{u("#comments").append(P)}u(".slide").slideDown();if(!u("#theaterComments").length){u("#comment_count").html(parseInt(u("#comment_count").html())+1)}u("#comment_preview_image_"+N).html("");u("#comment_image_"+N).val("");u("#comment_button_attach_"+N).show();q.registerImageComment();var Q=u("#postComment");K.resetMention(Q);var O=u("#theaterPhotoComment");K.resetMention(O);f.init()}u("body").trigger("afterPostCommentCallback",[])})}else{u(".shareButton").addClass("disabled");u(".shareButton").prepend('<i class="icon-refresh icon-spin"></i>');var M="";if(u("#commentForm").length){M=u("#commentForm").serialize()}if(u("#theaterPhotoCommentForm").length){M=u("#theaterPhotoCommentForm").serialize()}u.post(mooConfig.url.base+"/comments/ajax_share",M,function(P){u(".shareButton").removeClass("disabled");u(".shareButton i").remove();u(".commentForm").css("height","35px");if(u("#postComment").length){u("#postComment").val("")}if(u("#theaterPhotoComment").length){u("#theaterPhotoComment").val("")}if(P!=""){if(u("#theaterComments").length){u("#theaterComments").prepend(P)}else{u("#comments").prepend(P)}u(".slide").slideDown();if(!u("#theaterComments").length){u("#comment_count").html(parseInt(u("#comment_count").html())+1)}u("#comment_preview_image_"+N).html("");u("#comment_image_"+N).val("");u("#comment_button_attach_"+N).show();q.registerImageComment();var Q=u("#postComment");K.resetMention(Q);var O=u("#theaterPhotoComment");K.resetMention(O);f.init()}u("body").trigger("afterPostCommentCallback",[])})}}else{u.fn.SimpleModal({btn_ok:i.__("btn_ok"),model:"modal",title:i.__("warning"),contents:i.__("comment_empty")}).showModal()}};var z=function(N){if(u("#message_activity_comment_edit_"+N).siblings(".textoverlay")){u("#message_activity_comment_edit_"+N).destroyOverlayInstance(u("#message_activity_comment_edit_"+N))}u("#activity_feed_comment_text_"+N).show();u("#activity_comment_edit_"+N).remove();var M=u.inArray(N,j);j.splice(M,1);u("body").trigger("afterCancelFormEditCommentCallback",[])};var G=function(M){if(u.trim(u("#message_activity_comment_edit_"+M).val())!=""||u("#activity_comment_attach_id_"+M).val()!=""){var N;if(u("#message_activity_comment_edit_"+M+"_hidden").length!=0){N=u("#message_activity_comment_edit_"+M+"_hidden").val()}else{N=u("#message_activity_comment_edit_"+M).val()}u.post(mooConfig.url.base+"/activities/ajax_editActivityComment/"+M,{comment_attach:u("#activity_comment_attach_id_"+M).val(),message:N},function(O){if(u("#message_activity_comment_edit_"+M).siblings(".textoverlay")){u("#message_activity_comment_edit_"+M).destroyOverlayInstance(u("#message_activity_comment_edit_"+M))}u("#activity_feed_comment_text_"+M).html(u(O).html());u("#history_activity_comment_"+M).show();q.registerImageComment();z(M)})}};var D=function(N,M){u.fn.SimpleModal({btn_ok:i.__("btn_ok"),btn_cancel:i.__("btn_cancel"),callback:function(){u.post(mooConfig.url.base+"/comments/ajax_remove",{id:N},function(){u("#itemcomment_"+N).fadeOut("normal",function(){u("#itemcomment_"+N).remove();if(M!="0"){u("#comment_count").html(parseInt(u("#comment_count").html())-1)}else{u("#photo_comment_"+N).remove()}})})},title:i.__("please_confirm"),contents:i.__("confirm_delete_comment"),model:"confirm",hideFooter:false,closeButton:false}).showModal()};var J=function(O,N){if(u("#item_comment_edit_"+O).length==0){var M=0;if(N!="0"){M=1}u.post(mooConfig.url.base+"/comments/ajax_loadCommentEdit/"+O,{isPhotoComment:M},function(Q){var P="#item_feed_comment_text_";if(N!="0"){P="#photo_feed_comment_text_"}u(P+O).hide();u(Q).insertAfter(u(P+O));h.registerAttachCommentEdit("item",O);I.push(O);u("textarea:not(.no-grow)").autogrow();K.init(u(Q).find("textarea").attr("id"),"edit_activity");s.init(u(Q).find("textarea").attr("id"))})}};var l=function(P,M){if(u("#message_item_comment_edit_"+P).siblings(".textoverlay")){u("#message_item_comment_edit_"+P).destroyOverlayInstance(u("#message_item_comment_edit_"+P))}var N="#item_feed_comment_text_";if(M==1){N="#photo_feed_comment_text_"}u(N+P).show();u("#item_comment_edit_"+P).remove();var O=u.inArray(P,I);I.splice(O,1)};var c=function(N,M){if(u.trim(u("#message_item_comment_edit_"+N).val())!=""||u("#item_comment_attach_id_"+N).val()!=""){var O;if(u("#message_item_comment_edit_"+N+"_hidden").length!=0){O=u("#message_item_comment_edit_"+N+"_hidden").val()}else{O=u("#message_item_comment_edit_"+N).val()}u.post(mooConfig.url.base+"/comments/ajax_editComment/"+N,{comment_attach:u("#item_comment_attach_id_"+N).val(),message:O},function(P){if(u("#message_item_comment_edit_"+N).siblings(".textoverlay")){u("#message_item_comment_edit_"+N).destroyOverlayInstance(u("#message_item_comment_edit_"+N))}u("#item_feed_comment_text_"+N).html(u(P).html());u("#photo_feed_comment_text_"+N).html(u(P).html());u("#history_item_comment_"+N).show();u("#history_activity_comment_"+N).show();q.registerImageComment();l(N,M)})}};var n=function(M,N){u("#"+M+"_comment_attach_id_"+N).val("");u("#"+M+"_comment_preview_attach_"+N).html("");u("#"+M+"_comment_attach_"+N).show();u("body").trigger("afterRemovePhotoCommentCallback",[])};var g=function(M){u("#comments_"+M).show();u("#newComment_"+M).show();u("#commentForm_"+M).focus();u("#commentForm_"+M).focus();u("body").trigger("afterShowFormCommentCallback",[])};var d=function(M){u("#commentButton_"+M).show();if(u("#commentForm_"+M).length!=0&&u("#commentForm_"+M).siblings("input.messageHidden").length==0){K.init("commentForm_"+M);s.init("commentForm_"+M)}};return{ajax_postComment:y,initEditActivityComment:o,cancelEditActivityComment:z,confirmEditActivityComment:G,editItemComment:J,cancelEditItemComment:l,confirmEditItemComment:c,removePhotoComment:n,initShowCommentBtn:C,initShowCommentForm:v,initOnCommentForm:a,initOnCommentListing:A,initOnAjaxLoadCommentEdit:E,initRemoveItemComment:t,initEditItemComment:p,showCommentButton:d,initRemoveActivityComment:F,initOnAjaxLoadActivityCommentEdit:m}}));