(function(a,h){"function"===typeof define&&define.amd?define("jquery mooPhrase mooMention mooEmoji mooBehavior mooAlert mooTooltip mooUser elastislide".split(" "),h):"object"===typeof exports?module.exports=h(require("jquery")):a.mooPhotoTheater=h()})(this,function(a,h,X,Y,Z,F,G,aa){function t(){var b=a("#photo_src");a(window).height();if(b.data("size")&&""!=b.data("size")){tmp=b.data("size").split(",");var c=tmp[0];var e=tmp[1]}c&&e?H(b,c,e):a("<img/>").attr("src",a(b).attr("src")).load(function(){c=
this.width;e=this.height;H(b,c,e);a.post(mooConfig.url.base+"/photos/ajax_update_size",{photo_id:d,width:c,height:e})})}function I(){var b=a("#preload").html();""!=b&&(a("#preload").html(""),element=a("<div>"+b+"</div>"),data=element.find("#photo_wrapper").data(),d=data.photoid,k=data.taguid,g=data.taguserid,l=data.nextphoto,u=data.thumbfull,a("#photo-content #tag-wrapper").hide(),a("#photo-content .photo_comments").hide(),element.find(".photo_comments").html()&&(a("#photo-content .photo_comments").html(element.find(".photo_comments").html()),
a("#photo-content .photo_comments").show()),a("#photo_wrapper .info").html(element.find(".info").html()),a("#photo-content #tag-wrapper").html(element.find("#tag-wrapper").html()),a("#photo-content #lb_description").html(""),a("#photo-content #lb_description").html(element.find("#lb_description").html()),a("#photo_wrapper").spin("large"),J(),t())}function K(b,c){"1"==c&&a("#thumb_list_popup").is(":visible")&&n.setCurrent(a("#photo_thumb_"+b).index());a("#theaterPhotoComment").destroyOverlayInstance(a("#theaterPhotoComment"));
d=b;a("#thumb_list_popup .active").removeClass("active");a("#photo_thumb_"+d).addClass("active");a("#photo_wrapper").spin("large");var e="";e=k?b+"/uid:"+k:b;var f=e+"/time/"+(new Date).getTime();g&&(f+="?uid="+g,e+="?uid="+g);a("#preload").load(mooConfig.url.base+"/photos/ajax_view_theater/"+f,{noCache:0},function(){m=!1;a("#photoModal .slimScrollDiv").attr("style","");a("#theaterComments").attr("style","");I();G.init()});window.history.pushState({photo_id:d},"",mooConfig.url.base+"/photos/view/"+
e)}var d,L=!1,n,M=!1,N,v=!0,u,w,O=!1,m=!1,ba=0,l="",P,x=!1,p,q,y,z,A,B,C,D,k=0,g=0,H=function(b,c,d){d>=c?a(b).addClass("verticalImagePopup"):d<f-72?a(b).addClass("horizionImagePopup"):a(b).addClass("verticalImagePopup");0<a("#theaterPhotoComment").length&&(X.init("theaterPhotoComment"),Y.init("theaterPhotoComment"));a("#photo_wrapper").spin(!1);a("#tag-wrapper").show();a("#photo_src").css("visibility","visible");if(992<a(window).width()){var f=a(window).height();b=a("#photo_wrapper").width();a("#photoModal #tag-wrapper").height(f-
72);a("#photoModal #tag-wrapper .photo_img").height(f-72);a("#photoModal #tag-wrapper").width(b);a("#photoModal .photo_comments").height(f)}else f=a(window).height(),b=a(window).width(),a("#photoModal #tag-wrapper").height(f-36),a("#photoModal #tag-wrapper .photo_img").height(f-36),a("#photoModal #tag-wrapper").width(b)},ca=function(){a(".photoDetailTags").on("mouseout",function(){var b=a(this).data();Q("0-"+b.tagId)}).on("mouseover",function(){var b=a(this).data();R("0-"+b.tagId)})},da=function(){a(".photoDetailRemoveTags").unbind("click");
a(".photoDetailRemoveTags").on("click",function(){var b=a(this).data();S("0-"+b.id,b.id)})},T=function(){a(".showPhotoTheater").unbind("click");a(".showPhotoTheater").on("click",function(){var b=a(this).data();K(b.id,b.thumb)});ca();da()},V=function(b){a.post(mooConfig.url.base+"/photos/ajax_thumb_theater/"+d+"/"+b+(g?"?uid="+g:""),function(c){a("#photo_thumbs ul").append(c);b==N?U():V(b+1)})},ea=function(){a(document).on("click","a.photoModal",function(b){!mooConfig.force_login||mooConfig.photo_consider_force||
aa.validateUser()?L&&(b.preventDefault(),a("body").append('<div class="photo_modal_loading"></div>'),a(".photo_modal_loading").spin("large"),a.ajax({url:a(this).attr("href"),success:function(b){a("#photoModal .modal-content").html(b);a("#photoModal").modal("show");G.init()}})):b.preventDefault()})},fa=function(){a("#photoModal").on("shown.bs.modal",function(b){a(".photo_modal_loading").remove();W();t();v&&U()});a("#photoModal").on("hidden.bs.modal",function(b){history.pushState({},"",w);a("#photoModal .modal-content").html("");
a("#photoModal").removeData("bs.modal")})},W=function(){d=a("#photo_wrapper").data("photoid");k=a("#photo_wrapper").data("taguid");g=a("#photo_wrapper").data("taguserid");l=a("#photo_wrapper").data("nextphoto");u=a("#photo_wrapper").data("thumbfull");var b,c,e=a("#photo_wrapper").data("photocount"),f=a("#photo_wrapper").data("page");e>20*f?(N=Math.ceil(e/20),a("#photo_thumbs").spin(),a("#thumb_list_popup").hide(),v=!1,V(2)):v=!0;M||(a(window).resize(function(){0==a("#photo-content").length||a("#theaterPhotoComment").is(":focus")||
(992<a(window).width()?(b=a(window).height(),c=a("#photo_wrapper").width(),a("#photoModal #tag-wrapper").height(b-72),a("#photoModal #tag-wrapper .photo_img").height(b-72),a("#photoModal #tag-wrapper").width(c),a("#photoModal .photo_comments").height(b)):(b=a(window).height(),c=a(window).width(),a("#photoModal #tag-wrapper").height(b-36),a("#photoModal #tag-wrapper .photo_img").height(b-36),a("#photoModal #tag-wrapper").width(c)),t(),a("#photo_src").css("visibility","visible"))}),a(document).keydown(function(b){a("#theaterPhotoComment").is(":focus")||
a('[id^="message_item_comment_edit"]').is(":focus")||(37==b.keyCode?a("#photo_left_arrow_lg").trigger("click"):39==b.keyCode&&a("#photo_right_arro_lgw").trigger("click"))}),M=!0);a("#photo_thumbs ul li").unbind("click");a("#photo_thumbs ul li").click(function(){a("#photo_thumbs ul li").removeClass("active");a(this).addClass("active")});a("#photo_wrapper").spin("large");a("#tag-wrapper").hide();url=k?d+"/uid:"+k:g?d+"?uid="+g:d;w=window.location.href;"undefined"!=typeof url&&(window.history.pushState({photo_id:d},
"",mooConfig.url.base+"/photos/view/"+url),window.history.replaceState({photo_id:d},"",mooConfig.url.base+"/photos/view/"+url),P=window.location,J())},J=function(){a("#photo_wrapper .toogleThumb").unbind("click");a("#photo_wrapper .toogleThumb").click(function(){a("#photo_thumbs").toggle();a("#thumb_list_popup").is(":visible")&&n.setCurrent(a("#photo_thumb_"+d).index())});a("#set_photo_cover").unbind("click");a("#set_photo_cover").click(function(){ha()});m=!1;a("#tagPhoto").unbind("click");a("#tagPhoto").click(function(){m?
(m=!1,a("#tag-wrapper img").css("cursor","default"),a("#tagPhoto a").html(h.__("tag_photo")),a("#tag-name").unbind(),a("#tag-submit").unbind(),E()):ia()});a("#set_profile_picture").unbind("click");a("#set_profile_picture").click(function(){ja()});a("#delete_photo").unbind("click");a("#delete_photo").click(function(){l=""!=l?l:"0";F.confirm(h.__("are_you_delete"),mooConfig.url.base+"/photos/ajax_remove/photo_id:"+d+"/next_photo:"+l)});a("#photo_close_icon").unbind("click");a("#photo_close_icon").click(function(){history.pushState({},
"",w)});a(".sharethis_theater").hideshare({media:u,linkedin:!1,link:P});Z.registerImageComment();500<a("#theaterComments").height()&&a("#theaterComments").slimScroll({height:"500px",start:"top"}).bind("slimscroll",function(b,c){"bottom"==c&&""!=mooConfig.autoLoadMore&&0<a("#photoModal .view-more").length&&(a("#photoModal .view-more").before('<div style="text-align: center" class="loading"><img src="'+mooConfig.url.base+'/img/loading.gif" /></div>'),a("#photoModal .view-more").find("a").trigger("click"))});
a("#theaterPhotoComment").autogrow()},E=function(){a("#tag-target").fadeOut();a("#tag-input").fadeOut();a("#tag-name").val("")},ia=function(){m=!0;a("#tag-wrapper img").css("cursor","crosshair");a("#tagPhoto a").html(h.__("done_tagging"));a("#tag-wrapper img").unbind("click");a("#tag-wrapper img").click(function(b){m&&(y=b.pageX-a("#tag-wrapper").offset().left,z=b.pageY-a("#tag-wrapper").offset().top,A=a("#tag-target").outerWidth(),B=a("#tag-target").outerHeight(),p=y-A/2,q=z-B/2,C=y+A/2,D=z-B/2,
"block"==a("#tag-target").css("display")?(a("#tag-target").animate({left:p,top:q},500),a("#tag-input").animate({left:C,top:D},500)):(a("#tag-target").css({left:p,top:q}).fadeIn(),a("#tag-input").css({left:C,top:D}).fadeIn()),a("#tag-name").focus(),a("#friends_list").html(a("#friends").html()),a(".tagFriends").unbind("click"),a(".tagFriends").on("click",function(){var b=a(this).data();r(b.id,b.tagValue)}))});a("#tag-cancel").unbind("click");a("#tag-cancel").click(function(){E();return!1});a("#tag-name").keyup(function(a){13==
a.keyCode&&r(0,"")});a("#tag-submit").unbind("click");a("#tag-submit").click(function(){r(0,"");return!1})},r=function(b,c){if(""!=b||""!=a("#tag-name").val()){var e="left:"+p+"px; top:"+q+"px";a("#photo_wrapper").spin("large");a.post(mooConfig.url.base+"/photos/ajax_tag",{photo_id:d,uid:b,value:a("#tag-name").val(),style:e},function(d){a("#photo_wrapper").spin(!1);d=a.parseJSON(d);1==d.result?(c=b?'<a href="'+mooConfig.url.base+"/users/view/"+b+'">'+c+"</a>":a("#tag-name").val(),a("#tags").append('<span id="hotspot-item-0-'+
d.id+'" data-tag-id="'+d.id+'" class="photoDetailTags">'+c+'<a href="javascript:void(0)" class="photoDetailRemoveTags" data-id="'+d.id+'"><i class="material-icons cross-icon-sm">clear</i></a></span>'),a("#tag-wrapper .photo_img").append('<div id="hotspot-0-'+d.id+'" class="hotspot" style="'+e+'"><span>'+c+"</span></div>"),E(),ba++,T()):F.alert(d.message)})}},S=function(b,c){a("#hotspot-item-"+b).fadeOut();a("#hotspot-"+b).fadeOut();a.post(mooConfig.url.base+"/photos/ajax_remove_tag",{tag_id:c})},
R=function(b){a("#hotspot-"+b).addClass("hotspothover")},Q=function(b){a("#hotspot-"+b).removeClass("hotspothover")},U=function(){x=!1;n=a("#thumb_list_popup").elastislide({minItems:2,onReady:function(){n.setCurrent(a("#photo_thumb_"+d).index());a("#photo_thumbs").spin(!1);a("#photo_thumbs").css("visibility","visible");x||(x=!0,a("#photo_thumbs").toggle())}});a("#photo_thumb_"+d).addClass("active")},ha=function(){a("#set_cover").spin("custom");a.post(mooConfig.url.base+"/users/set_photo_as_cover",
{photo_id:d},function(b){b=a.parseJSON(b);location.assign(b.url)})},ja=function(){a("#set_avatar").spin("custom");a.post(mooConfig.url.base+"/users/set_photo_as_profile_picture",{photo_id:d},function(b){b=a.parseJSON(b);window.location=b.url})};return{init:function(){O||fa();O=!0;ea()},initShowPhoto:T,start:function(){W()},submitTag:function(a,c){r(a,c)},removeTag:function(a,c){S(a,c)},hideTag:function(a){Q(a)},showTag:function(a){R(a)},showPhotoWrapper:function(){I()},showPhoto:function(a,c){"undefined"==
typeof c&&(c=!1);K(a,c)},setActive:function(a){L=a}}});