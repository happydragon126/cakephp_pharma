(function(a,c){"function"===typeof define&&define.amd?define("jquery mooButton mooPhrase mooGlobal mooFileUploader mooValidate typeahead bloodhound tagsinput".split(" "),c):"object"===typeof exports?module.exports=c(require("jquery")):a.mooCredit=c()})(this,function(a,c,e,n,p,q,r,t,u){var f=function(){var b=new Bloodhound({datumTokenizer:function(a){return Bloodhound.tokenizers.whitespace(a.name)},queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:mooConfig.url.base+"/credits/get_member.json",
cache:!1,filter:function(b){return a.map(b.data,function(a){return a})}},identify:function(a){return a.id}});b.initialize();a("#friendSuggestion").tagsinput({freeInput:!1,itemValue:"id",itemText:"name",typeaheadjs:{name:"friends_friendSuggestion",displayKey:"name",highlight:!0,limit:10,source:b.ttAdapter(),templates:{notFound:'<div class="empty-message"> unable to find any member </div>',suggestion:function(b){return""!=a("#userTagging").val()&&-1!=a("#friendSuggestion").val().split(",").indexOf(b.id)?
'<div class="empty-message" style="display:none">unable to find any member</div>':['<div class="suggestion-item">','<img alt src="'+b.avatar+'"/>','<span class="text">'+b.name+"</span>","</div>"].join("")}}}});a("#sendButton").click(function(){c.disableButton("sendButton");a("#sendButton").spin("small");a.post(mooConfig.url.base+"/credits/ajax_doSend",jQuery("#sendCredits").serialize(),function(b){c.enableButton("sendButton");a("#sendButton").spin(!1);b=a.parseJSON(b);1==b.result?(a("#friend").val(""),
a("#credit").val(""),a(".error-message").hide(),a(".alert-success").show(),a(".alert-success").html(b.message)):(a(".alert-success").hide(),a(".error-message").show(),a(".error-message").html(b.message))});return!1})},g=function(){a("#friends").tokenInput(mooConfig.url.base+"/friends/do_get_json",{preventDuplicates:!0,hintText:e.__("Enter a friend's name"),noResultsText:e.__("No results"),tokenLimit:10,resultsFormatter:function(a){return"<li>"+a.avatar+a.name+"</li>"}});a("#sendButton").click(function(){c.disableButton("sendButton");
a("#sendButton").spin("small");a.post(mooConfig.url.base+"/credits/ajax_doSend",jQuery("#sendCredits").serialize(),function(b){c.enableButton("sendButton");a("#sendButton").spin(!1);b=a.parseJSON(b);1==b.result?(a("#friend").val(""),a("#credit").val(""),a(".error-message").hide(),a(".alert-success").show(),a(".alert-success").html(b.message)):(a(".alert-success").hide(),a(".error-message").show(),a(".error-message").html(b.message))});return!1})},h=function(){c.disableButton("createButton");a.post(mooConfig.url.base+
"/credits/faq_save",a("#createForm").serialize(),function(b){c.enableButton("createButton");b=a.parseJSON(b);1==b.result?location.reload():(a(".error-message").show(),a(".error-message").html("<strong>Error! </strong>"+b.message))});return!1},k=function(){a("#createFormWithDraw").validate({errorClass:"error-message",errorElement:"div"});a("#amount").on("keyup",function(){var b=a(this).val()*formula_credit/formula_money;a("#wd_money").text(b)});a.validator.addMethod("compare",function(a,c,d){return parseInt(a)>=
parseInt(minimum_withdrawal_amount)&&parseInt(a)<=parseInt(maximum_withdrawal_amount)?!0:!1},e.__("validate_between"));a("#btnWithDraw").on("click",function(){a("#amount").rules("add",{required:!0,number:!0,compare:a("#amount").val()});a("#payment").rules("add",{required:!0});a("#payment_info").rules("add",{required:function(b){return"none"==a("#li_payment_info").css("display")?!1:!0}})});a("#payment").on("change",function(){""!=a("#payment option:selected").val()?a("#li_payment_info").show():a("#li_payment_info").hide()});
a(".delete_withdraw_request").on("click",function(){var b=a(this).attr("data-id");a("#themeModal .modal-content").load(url+"/credits/withdraw_delete/"+b);a("#themeModal").modal("show")})},l=function(){a("body").on("validateCredit",function(a,c){c.status=!1;c.message=e.__("credit_amount_not_enought")})},m=function(b,c){a('input[type="submit"]').prop("disabled",!0);a("#buyCreditForm input").on("change",function(){a('input[type="submit"]').prop("disabled",!1);var d=a("input[name=sell_selected]:checked",
"#buyCreditForm").val().split("_");a("#sell_id").val(d[0]);a("#amount").val(d[1]);a("#return").val(b+"/"+d[0]+"?app_no_tab=1");a("#notify_url").val(c+"/"+d[0])})};return{init:function(){l()},initCreditSendToMember:function(){f()},initCreditSendToFriend:function(){g()},creditFaqCreate:function(){h()},toggleField:function(){a(".opt_field").toggle()},uploader:function(){uploader()},initWithDrawRequest:function(){k()},initBuyCreditPaypal:function(a,c){m(a,c)}}});