(function(b,d){"function"===typeof define&&define.amd?define("jquery mooButton mooPhrase mooGlobal mooFileUploader mooAlert".split(" "),d):"object"===typeof exports?module.exports=d(require("jquery")):b.mooGift=d()})(this,function(b,d,c,u,v,g){function r(a,n){b(b("#portlet-config  .modal-header .modal-title")[0]).html(c.__("please_confirm"));b(b("#portlet-config  .modal-body")[0]).html(a);b("#portlet-config  .modal-footer .ok").off("click").click(function(){n();b("#portlet-config").modal("hide")});
    b("#portlet-config").modal("show")}var w=function(){var a=jQuery(jQuery("#friendItemTemplate").html());b("#GiftFriend").autocomplete({source:function(a,e){b.post(mooConfig.url.base+"/gifts/suggest_friend/","keyword="+b("#GiftFriend").val(),function(a){e(b.parseJSON(a))})},minLength:2,select:function(n,e){a.find(".name").empty().append(e.item.label);jQuery("#wrapper_friend").empty().append(a);b("#GiftFriendId").val(e.item.value);jQuery("#GiftFriend").val("");jQuery(".ui-autocomplete.ui-menu").hide();
        return!1},change:function(n,e){e.item?(a.find(".name").empty().append(e.item.label),jQuery("#wrapper_friend").empty().append(a),b("#GiftFriendId").val(e.item.value),jQuery("#GiftFriend").val(""),jQuery(".ui-autocomplete.ui-menu").hide()):b(this).val("")},focus:function(a,e){a.preventDefault();b("#GiftFriendId").val(e.item.value);jQuery("#GiftFriend").val(e.item.label)}});jQuery(document).on("click",".friend_item .remove",function(){jQuery("#GiftFriendId").val("");jQuery(this).parent().remove()})},
    h=function(a){if("undefined"==typeof a.is_ffmpeg_installed||""==a.is_ffmpeg_installed)a.is_ffmpeg_installed="";switch(a.type){case "photo":p({extension:c.__("gift_ext_photo"),btn_text:c.__("tdescphoto"),type:a.type});break;case "audio":p({extension:c.__("gift_ext_audio"),btn_text:c.__("tdescaudio"),type:a.type});break;case "video":1==parseInt(a.is_ffmpeg_installed)?p({extension:c.__("gift_ext_video"),btn_text:c.__("tdescvideo"),type:a.type}):g.alert(c.__("ffmpeg_not_found"))}b("#GiftType").val(a.type)},
    p=function(a){if("undefined"==typeof a.extension||""==a.extension)a.extension=c.__("gift_ext_photo");if("undefined"==typeof a.btn_text||""==a.btn_text)a.btn_text=c.__("tdescphoto");if("undefined"==typeof a.type||""==a.type)a.type="photo";if("undefined"==typeof a.uploader_id||""==a.uploader_id)a.uploader_id="select-0";if("undefined"==typeof a.value_id||""==a.value_id)a.value_id="GiftFilename";if("undefined"==typeof a.preview_id||""==a.preview_id)a.preview_id="item-avatar";new v.fineUploader({element:b("#"+
        a.uploader_id)[0],multiple:!1,text:{uploadButton:'<div class="upload-section"><i class="icon-camera"></i>'+a.btn_text+"</div>"},validation:{allowedExtensions:a.extension,sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+"/gifts/upload_file/"+a.type},callbacks:{onError:u.errorHandler,onComplete:function(n,e,c){b("#"+a.value_id).val(c.filename);b("#"+a.preview_id).hide();"photo"==a.type&&(b("#"+a.preview_id).attr("src",c.path),b("#"+a.preview_id).show())}}})},t=function(a){"undefined"!=
    typeof a.save&&1==a.save?(b("#createForm #GiftSaved").val(1),d.disableButton("button_save")):(b("#createForm #GiftSaved").val(0),d.disableButton("button_send"));b.post(mooConfig.url.base+"/gifts/save/",b("#createForm").serialize(),function(a){a=b.parseJSON(a);0==a.result?(b(".error-message").empty().append(a.message).show(),d.enableButton("button_send"),d.enableButton("button_save")):a.url&&(window.location=mooConfig.isApp?a.url+"?app_no_tab=1":a.url)})},x=function(){b.post(mooConfig.url.base+"/gifts/preview/",
        b("#createForm").serialize(),function(a){b("#themeModal .modal-content").empty().append(a);b("#themeModal").modal()});b("#themeModal").on("hidden.bs.modal",function(){b("#themeModal .modal-content").empty()})},y=function(a){function b(a){a=a.pageX-l;0<=a&&a<=f&&(k.style.width=a+"px");0>a&&(k.style.width="0px");a>f&&(k.style.width=f+"px")}function e(){k.style.width=d.currentTime/m*f+"px";d.currentTime==m&&(h.className="",h.className="play")}if(0!=jQuery("#music").length){var c=a.dialog,d=document.getElementById("music"),
        h=document.getElementById("pButton"),k=document.getElementById("playhead");a=document.getElementById("timeline");if("undefined"!=typeof c)if(c=parseFloat(jQuery(".modal-dialog").width()),0==c){c=jQuery(document).width()-parseFloat(jQuery(".modal-body").css("margin-right"))-parseFloat(jQuery(".modal-body").css("margin-left"));var f=c-102-81,l=(jQuery(document).width()-c)/2+parseFloat(jQuery(".modal-body").css("padding-left"))+102}else f=c-parseFloat(jQuery(".modal-body").css("padding-right"))-parseFloat(jQuery(".modal-body").css("padding-left"))-
        102,l=(jQuery(document).width()-c)/2+parseFloat(jQuery(".modal-body").css("padding-left"))+102;else f=a.offsetWidth-k.offsetWidth,l=a.offsetLeft;d.addEventListener("timeupdate",e,!1);a.addEventListener("click",function(a){b(a);d.currentTime=(a.pageX-l)/f*m},!1);k.addEventListener("mousedown",function(){g=!0;window.addEventListener("mousemove",b,!0);d.removeEventListener("timeupdate",e,!1)},!1);window.addEventListener("mouseup",function(a){1==g&&(b(a),window.removeEventListener("mousemove",b,!0),d.currentTime=
        (a.pageX-l)/f*m,d.addEventListener("timeupdate",e,!1));g=!1},!1);var g=!1;d.addEventListener("canplaythrough",function(){m=d.duration},!1);var m=d.duration;a.style.width=f+"px"}},z=function(a){b("#choose_photo").click(function(){jQuery(".type-img").removeClass("active");jQuery(this).addClass("active");h({type:"photo"})});b("#choose_audio").click(function(){jQuery(".type-img").removeClass("active");jQuery(this).addClass("active");h({type:"audio"})});b("#choose_video").click(function(){jQuery(".type-img").removeClass("active");
        jQuery(this).addClass("active");h({type:"video",is_ffmpeg_installed:a.is_ffmpeg_installed})});b("#button_send").click(function(){r(c.__("send_gift_confirm"),function(){t({save:0})})});b("#button_save").click(function(){t({save:1})});b("#button_preview").click(function(){x()})},q=function(a){b("#my-gift-type li").removeClass("class");b("#"+a.item).addClass("active");b.post(mooConfig.url.base+"/gifts/ajax_browse/my/"+a.type,"",function(a){b("#list-content").empty().append(a)})},A=function(){b("#saved_gifts").click(function(){q({item:"saved_gifts",
        type:"saved"});window.history.pushState({},"",mooConfig.url.base+"/gifts/index/my/saved")});b("#received_gifts").click(function(){q({item:"received_gifts",type:"received"});window.history.pushState({},"",mooConfig.url.base+"/gifts/index/my/received")});b("#sent_gifts").click(function(){q({item:"sent_gifts",type:"sent"});window.history.pushState({},"",mooConfig.url.base+"/gifts/index/my/sent")})},B=function(a){b(".menu-gift li#browse_all a").click(function(){b("#center > .bar-content").removeClass("my-gift-wrap")});
        b(".menu-gift li#my-gift a").click(function(){b("#center > .bar-content").addClass("my-gift-wrap")});"my"==a.type&&b("#center > .bar-content").addClass("my-gift-wrap")},C=function(){b(".view_gift").click(function(){var a=b(this).data();b.post(mooConfig.url.base+"/gifts/ajax_view/"+a.id,"",function(a){b("#themeModal .modal-content").empty().append(a);b("#themeModal").modal()});b("#themeModal").on("hidden.bs.modal",function(){b("#themeModal .modal-content").empty()})})},D=function(){b(".send_gift").click(function(){var a=
        b(this).data();r(c.__("send_gift_confirm"),function(){d.disableButton("btnSendGift");var c=a.id;b.post(mooConfig.url.base+"/gifts/ajax_send_gift/","id="+c,function(a){a=jQuery.parseJSON(a);d.enableButton("btnSendGift");0!=a.result&&b("#mygift"+c).remove();g.alert(a.message)})})})},E=function(){b(".delete_gift").click(function(){var a=b(this).data(),d=a.gift_sent_id,e=a.gift_id;b.fn.SimpleModal({btn_ok:c.__("btn_ok"),btn_cancel:c.__("btn_cancel"),model:"confirm",callback:function(){b.post(mooConfig.url.base+
        "/gifts/ajax_delete_gift/","gift_sent_id="+d+"&gift_id="+e,function(a){a=jQuery.parseJSON(a);0!=a.result&&(""!=d?jQuery("#mygift"+d).remove():jQuery("#mygift"+e).remove());g.alert(a.message)})},title:c.__("please_confirm"),contents:c.__("delete_gift_confirm"),hideFooter:!1,closeButton:!1}).showModal()})},F=function(){b(".play_audio").click(function(){var a=document.getElementById("music"),b=document.getElementById("pButton");a.paused?(a.play(),b.className="",b.className="pause"):(a.pause(),b.className=
        "",b.className="play")})};return{initSuggestFriend:function(){w()},selectCreateGiftType:function(a){h(a)},initCreate:function(a){z(a)},loadMyGifts:function(){A()},initNavGift:function(a){B(a)},viewGift:function(){C()},sendGift:function(){D()},deleteGift:function(){E()},playAudio:function(){F()},initAudio:function(a){y(a)}}});