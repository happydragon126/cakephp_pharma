(function(a,g){"function"===typeof define&&define.amd?define("jquery mooUser mooBehavior mooButton mooFileUploader mooAjax mooAlert mooPhrase mooGlobal tinyMCE mooTooltip mooJqueryUi mooCountdown".split(" "),g):"object"===typeof exports?module.exports=g(require("jquery")):a.mooQuiz=g()})(this,function(a,g,p,d,q,k,u,e,r,h,t){var v=function(){a("#saveBtn").unbind("click");a("#saveBtn").click(function(){d.disableButton("saveBtn");d.disableButton("nextBtn");d.disableButton("cancelBtn");d.disableButton("deleteBtn");
if(null!==h.activeEditor){var b=h.activeEditor.getContent();b=b.replace(/(<div>&nbsp;<\/div>)+/gi," ");b=b.replace(/(<p>&nbsp;<\/p>)+/gi," ");b=b.replace(/^\s+|\s+$/g,"");null===b||""===b?a("#editor").val(""):a("#editor").val(h.activeEditor.getContent())}k.post({url:mooConfig.url.base+"/quizzes/save",data:a("#createForm").serialize()},function(b){b=a.parseJSON(b);1===b.result?window.location.href=mooConfig.isApp?mooConfig.url.base+"/quizzes/create/"+b.id+"?app_no_tab=1":mooConfig.url.base+"/quizzes/create/"+
b.id:(d.enableButton("saveBtn"),d.enableButton("nextBtn"),d.enableButton("cancelBtn"),d.enableButton("deleteBtn"),a(".error-message").show(),a(".error-message").html(b.message))})});var b=new q.fineUploader({element:a("#attachments_upload")[0],autoUpload:!1,text:{uploadButton:'<div class="upload-section"><i class="material-icons">insert_drive_file</i>'+e.__("quiz_drag_ok_click_here_to_upload_files")+" </div>"},validation:{allowedExtensions:mooConfig.photoExt,sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+
"/quiz/quiz_upload/attachments"},callbacks:{onError:r.errorHandler,onComplete:function(a,b,f){h.activeEditor.insertContent('<p align="center"><a href="'+f.large+'" class="attached-image"><img src="'+f.thumb+'"></a></p><br>')}}});a("#triggerUpload").click(function(){b.uploadStoredFiles()});new q.fineUploader({element:a("#quiz_thumnail")[0],multiple:!1,text:{uploadButton:'<div class="upload-section"><i class="material-icons">photo_camera</i>'+e.__("drag_or_click_here_to_upload_photo")+"</div>"},validation:{allowedExtensions:mooConfig.photoExt,
sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+"/quiz/quiz_upload/avatar"},callbacks:{onError:r.errorHandler,onComplete:function(b,l,f){a("#quiz_thumnail_preview > img").attr("src",f.thumb);a("#quiz_thumnail_preview > img").show();a("#thumbnail").val(f.file_path)}}});n();a("#toggleUploader").unbind("click");a("#toggleUploader").on("click",function(){a("#images-uploader").slideToggle()});a("#unlimit_timer").unbind("click");a("#unlimit_timer").click(function(){!0===this.checked?
a("#timer").attr("disabled",!0):a("#timer").attr("disabled",!1)})},w=function(){t.init();n();p.initMoreResults();p.initAutoLoadMore();a(".browseQuizzes a:not(.overlay):not(.no-ajax)").unbind("click");a(".browseQuizzes a:not(.overlay):not(.no-ajax)").click(function(b){b.preventDefault();var c=a(this);c.spin("tiny");c.children(".badge_counter").hide();c.parent().is("li:not(.no-current)")&&(a(".browseQuizzes li:not(.no-current)").removeClass("current"),c.parent().addClass("current"));b=c.attr("rel");
void 0===b&&(b="list-content");a("#"+b).load(c.attr("data-url")+"?"+a.now(),function(b){try{a.parseJSON(b).data}catch(f){b}c.children(".badge_counter").fadeIn();c.spin(!1);a(".tip").tipsy({html:!0,gravity:"s"});a(".truncate").each(function(){if(145<=parseInt(c.css("height"))){var b=a('<a href="javascript:void(0)" class="show-more">'+c.data("more-text")+"</a>");c.after(b);b.click(function(a){showMore(this)})}});window.history.pushState({},"",c.attr("href"));992>a(window).width()&&(a("#leftnav").modal("hide"),
a("body").scrollTop(0))});return!1});a(".likeItem").unbind("click");a(".likeItem").click(function(){var b=a(this),c=a(this).data(),l=c.status;a.post(mooConfig.url.base+"/likes/ajax_add/"+c.type+"/"+c.id+"/"+l,{noCache:1},function(c){try{var d=a.parseJSON(c);b.parents(".like-section:first").find(".likeCount:first").html(parseInt(d.like_count));b.parents(".like-section:first").find(".dislikeCount:first").html(parseInt(d.dislike_count));l?(b.toggleClass("active"),b.next().next().removeClass("active")):
(b.toggleClass("active"),b.prev().prev().removeClass("active"))}catch(m){g.validateUser()}})})},x=function(){t.init();a("#duration_element").addClass("hidden");a(".loadQuizView a:not(.overlay):not(.no-ajax)").unbind("click");a(".loadQuizView a:not(.overlay):not(.no-ajax)").click(function(b){b.preventDefault();var c=a(this);c.spin("tiny");c.parent().is("li:not(.no-current)")&&(a(".loadQuizView li:not(.no-current)").removeClass("current"),c.parent().addClass("current"));c.parent().is(".app-load-quiz-view")&&
(a(".loadQuizView .app-load-quiz-view").removeClass("current"),c.parent().addClass("current"));b=c.attr("rel");void 0===b&&(b="quiz-content");a("#"+b).load(c.attr("data-url")+"?"+a.now(),function(b){try{a.parseJSON(b).data}catch(f){b}c.spin(!1);a("textarea:not(.no-grow)").autogrow();a(".tip").tipsy({html:!0,gravity:"s"});window.history.pushState({},"",c.attr("href"));992>a(window).width()&&(a("#leftnav").modal("hide"),a("body").scrollTop(0))});return!1});a("#resetBtn").unbind("click");a("#resetBtn").click(function(){a("#takeForm").trigger("reset")});
n()},y=function(){a("#startBtn").unbind("click");a("#startBtn").click(function(){a("#startBtn").spin("small");d.disableButton("startBtn");a.post(mooConfig.url.base+"/quizzes/do_take_privacy",a("#takePrivacyForm").serialize(),function(b){b=a.parseJSON(b);1==b.result?(a("#quiz-content").load(mooConfig.url.base+"/quizzes/view_take?"+a.now(),{quiz_id:b.quiz_id,privacy_hash:b.privacy_hash},function(b){try{a.parseJSON(b).data}catch(l){b}992>a(window).width()&&(a("#leftnav").modal("hide"),a("body").scrollTop(0))}),
a("#themeModal").modal("hide")):window.location.reload()});return!1})},A=function(b){0<b&&z(b);a("#submitAnswerBtn").unbind("click");a("#submitAnswerBtn").click(function(){d.disableButton("submitAnswerBtn");var b=a(this).data();k.post({url:mooConfig.url.base+"/quizzes/do_take/"+b.id,data:a("#takeForm").serialize()},function(b){b=a.parseJSON(b);1===b.result?(a(".loadQuizView #quizDetail").trigger("click"),a.fn.SimpleModal().hideModal(),a.fn.SimpleModal({title:e.__("quiz_thank_you_for_taking_our_quiz"),
model:"modal-ajax",param:{url:mooConfig.url.base+"/quizzes/view_finish/"+b.take_id},onAppend:function(){var b=this,c=a("<a>").attr({title:e.__("quiz_confirm"),"class":"btn btn-action btn-not-margin"}).click(function(){b.hideModal();a(window).scrollTop(0);mooConfig.isApp&&window.location.reload()}).text(e.__("quiz_confirm"));a("#simple-modal").find(".simple-modal-header").addClass("text-center");a("#simple-modal").find(".simple-modal-footer").addClass("text-center").append(c)}}).showModal()):2===b.result?
(a.fn.SimpleModal().hideModal(),a.fn.SimpleModal({title:e.__("quiz_please_confirm"),contents:'<div style="margin-bottom: 10px">'+e.__("quiz_you_are_not_finish_all_question_are_you_sure_you_want_to_submit_your_answers")+"</div>",model:"content",onAppend:function(){var b=this,c="btn btn-action";mooConfig.isApp&&(c="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--raised mdl-button--colored1");c=a("<a>").attr({title:e.__("quiz_confirm"),"class":c}).click(function(){b.hideModal();a("#direct_point").remove();
a("#submitAnswerBtn").trigger("click")}).text(e.__("quiz_confirm"));var d=a("<a>").attr({title:e.__("quiz_cancel"),"class":"button"}).click(function(){b.hideModal()}).text(e.__("quiz_cancel"));a("#simple-modal").find(".simple-modal-footer").append(c).append(d)}}).showModal(),d.enableButton("submitAnswerBtn")):3===b.result?window.location.reload():(d.enableButton("submitAnswerBtn"),a(".error-message").show(),a(".error-message").html(b.message))})})},z=function(b){function c(a){var b=a.match(k),c={};
f.forEach(function(a,d){c[a]=b[d]});return c}function d(a,b){var c=[];f.forEach(function(d){a[d]!==b[d]&&c.push(d)});return c}a("#duration_element").removeClass("hidden");a("#duration_element .duration").empty().append(a("<div>",{id:"duration","class":"countdown-container"}));var f=["hours","minutes","seconds"];b=(new Date).getTime()+1E3*b;var g="00:00:00",m="00:00:00",k=/([0-9]{2})/gi,h=a("#duration");f.forEach(function(a){h.append('<div class="time '+a+'"><span class="count curr top">00</span><span class="count next top">00</span><span class="count next bottom">00</span><span class="count curr bottom">00</span><span class="label">'+
e.__("quiz_"+a)+"</span></div>")});h.countdown(b,function(a){a=a.strftime("%I:%M:%S");if(a!==m){g=m;m=a;var b=c(g);var e=c(m);d(b,e).forEach(function(a){var c=".%s".replace(/%s/,a),d=h.find(c);d.removeClass("flip");d.find(".curr").text(b[a]);d.find(".next").text(e[a]);setTimeout(function(){d.addClass("flip")},50)})}}).on("finish.countdown",function(){this.remove();a("#direct_point").remove();a("#submitAnswerBtn").trigger("click")})},n=function(){a(".deleteQuiz").unbind("click");a(".deleteQuiz").click(function(){var b=
a(this).data(),c="btn btn-action",d=mooConfig.url.base+"/quizzes/delete/"+b.id;mooConfig.isApp&&(d=mooConfig.url.base+"/quizzes/confirm_delete/"+b.id+"?app_no_tab=1",c="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--raised mdl-button--colored1");a.fn.SimpleModal({title:e.__("quiz_please_confirm"),contents:'<div style="margin-bottom: 10px">'+e.__("quiz_are_you_sure_you_want_to_remove_this_quiz")+"</div>",model:"content",onAppend:function(){var b=this,l=a("<a>").attr({title:e.__("quiz_confirm"),
"class":c}).click(function(){b.hideModal();window.location.href=d}).text(e.__("quiz_confirm")),g=a("<a>").attr({title:e.__("quiz_cancel"),"class":"button"}).click(function(){b.hideModal()}).text(e.__("quiz_cancel"));a("#simple-modal").find(".simple-modal-footer").append(l).append(g)}}).showModal()})},B=function(){a(".createQuestion").unbind("click");a(".createQuestion").click(function(){var b=a(this);b.spin("small");var c=b.data();k.post({url:mooConfig.url.base+"/quizzes/question/create/"+c.quiz_id+
"/"+c.quiz_question_id},function(c){b.spin(!1);a("#questions-create").html(c);a("html, body").animate({scrollTop:a("#questions-create").offset().top-a("#header").height()/2},500)})});a("#orderQuestion").unbind("click");a("#orderQuestion").click(function(){var b=a(this).data(),c=a("#sortable_questions").sortable("toArray");k.post({url:mooConfig.url.base+"/quizzes/question/sort/"+b.quiz_id,data:{ids:c}},function(b){b=a.parseJSON(b);1===b.result?window.location.reload():(a(".error-message").show(),a(".error-message").html(b.message))})});
a("#sortable_questions").sortable({items:"li.item_question",handle:".reorder"})},C=function(){a("#saveBtn").unbind("click");a("#saveBtn").click(function(){d.disableButton("saveBtn");d.disableButton("nextBtn");d.disableButton("cancelBtn");d.disableButton("orderQuestion");d.disableButton("createQuestion");k.post({url:mooConfig.url.base+"/quizzes/question/save",data:a("#createForm").serialize()},function(b){b=a.parseJSON(b);1===b.result?window.location.reload():(d.enableButton("saveBtn"),d.enableButton("nextBtn"),
d.enableButton("cancelBtn"),d.enableButton("orderQuestion"),d.enableButton("createQuestion"),a(".error-message").show(),a(".error-message").html(b.message))})});a("#cancelBtn").unbind("click");a("#cancelBtn").click(function(){a("#questions-create").empty();a("html, body").animate({scrollTop:a("#questions-list-content").offset().top-a("#header").height()/2},500)});a(".tip").tipsy({html:!0,gravity:"s"});a("#sortable_answers").sortable({handle:".reorder"});a("#addNewAnswer").unbind("click");a("#addNewAnswer").click(function(){var b=
a("#addNew").clone();b.removeAttr("id").removeClass("hide");b.appendTo(a("#sortable_answers"))});a("body").off("click",".remove_answer");a("body").on("click",".remove_answer",function(){a(this).parents("li.placeholder").remove()});a("body").off("click",".resulttmp");a("body").on("click",".resulttmp",function(){a("#sortable_answers input:checkbox").prop("checked",!1);a("#sortable_answers #answersCorrect").val(0);a(this).prop("checked",!0);var b=a(this).prev();b.is("input")&&b.val(a(this).is(":checked")?
1:0)})},D=function(){a("#deleteQuestion").unbind("click");a("#deleteQuestion").click(function(){var b=a(this).data();a.post(b.url,{noCache:1},function(){window.location.reload()})})},E=function(){a("#unPublishBtn").unbind("click");a("#unPublishBtn").click(function(){var b=a(this).data();b=mooConfig.url.base+"/quizzes/publish/"+b.id+"/0";u.confirm(e.__("quiz_are_you_sure_you_want_to_unpublish_this_quiz"),b)})};return{initOnCreate:function(){v()},initOnListingQuiz:function(){w()},initOnListingQuestion:function(){B()},
initOnCreateQuestion:function(){C()},initOnDeleteQuestion:function(){D()},initOnPublish:function(){E()},initOnView:function(){x()},initOnViewAppProfile:function(){0===a("#profile-content").length&&a("#profile-content-wrap").wrapAll('<div id="profile-content" />')},initTakePrivacy:function(){y()},initTakeQuiz:function(a){A(a)}}});