(function(a,c){"function"===typeof define&&define.amd?define("jquery mooBehavior mooFileUploader mooAjax mooOverlay mooAlert mooPhrase mooGlobal tinyMCE mooUser mooButton".split(" "),c):"object"===typeof exports?module.exports=c(require("jquery")):a.mooClassified=c()})(this,function(a,c,h,u,k,e,f,v,w,x,g){var l=function(){a(".fb_vote").unbind("click");a(".fb_vote").click(function(){var b=a(this).attr("ref");jQuery.feedback.vote(b,a(this))})},q=function(){k.registerImageOverlay();a(".fb_approve").unbind("click");
a(".fb_approve").click(function(){a(this).attr("ref")});m();n();p();a(".fb_vote").unbind("click");a(".fb_vote").click(function(){var b=a(this).attr("ref");jQuery.feedback.vote(b,a(this))})},r=function(){jQuery(window).load(function(){jQuery.post(mooConfig.url.base+"/feedbacks/popups/load_shortcut","",function(a){jQuery("body").append(a);jQuery.feedback.initFeedbackUploader();jQuery.feedback.initFeedbackImage()})})};jQuery.feedback={vote:function(a,d){d.addClass("disabled");jQuery.post(mooConfig.url.base+
"/feedbacks/feedbackvotes/ajax_add/"+a,function(a){a=jQuery.parseJSON(a);0==a.result?e.alert(a.message):(jQuery("."+a.feedback).html(parseInt(a.total_votes)),jQuery("."+a.feedback).parent().find("span").empty().append(a.text),jQuery(".a_"+a.feedback).html(a.action));d.removeClass("disabled")})},initFeedbackUploader:function(b){b=function(b,d,y,c){0<a("#attachments_upload .qq-upload-list .errorUploadMsg").length?a("#attachments_upload .qq-upload-list .errorUploadMsg").html(f.__("tmaxsize")):a("#attachments_upload .qq-upload-list").prepend('<div class="errorUploadMsg">'+
f.__("tmaxsize")+"</div>");a("#attachments_upload .qq-upload-fail").remove()};if(0<a("#uploader").length){var d=new h.fineUploader({element:a("#uploader")[0],autoUpload:!1,text:{uploadButton:'<div class="upload-section"><i class="material-icons">camera_alt</i>'+f.__("tdesc")+"</div>"},validation:{allowedExtensions:["jpg","jpeg","gif","png"]},request:{endpoint:mooConfig.url.base+"/feedbacks/upload/"},callbacks:{onError:b,onComplete:function(b,d,c){b=a("#FeedbackAttachments").val();c.feedback_image_id?""==b?a("#FeedbackAttachments").val(c.feedback_image_id):
a("#FeedbackAttachments").val(b+","+c.feedback_image_id):0==c.result&&e.alert(c.message)}}});a("#triggerUpload").unbind("click");a("#triggerUpload").click(function(){d.uploadStoredFiles()})}},createFeedback:function(b){g.disableButton("createButton");jQuery.post(mooConfig.url.base+"/feedbacks/feedbacks/ajax_save",jQuery("#createForm").serialize(),function(b){g.enableButton("createButton");b=a.parseJSON(b);1==b.result?b.url?window.location=b.url:(a("#add").attr("href",a("#add").attr("href")+b.id),
jQuery.post(mooConfig.url.base+"/feedbacks/feedbacks/ajax_thanks/","id="+b.id+"&approved="+b.approved,function(a){jQuery("#themeModal .modal-content").empty().append(a)})):(a(".error-message").show(),a(".error-message").html(b.message),0<a(".spinner").length&&a(".spinner").remove(),0<jQuery("#captcha").length&&grecaptcha.reset())})},initFeedbackImage:function(){jQuery(".attach_remove").each(function(){var b=a("#FeedbackAttachments").val();""==b?a("#FeedbackAttachments").val(jQuery(this).data("id")):
a("#FeedbackAttachments").val(b+","+jQuery(this).data("id"))})},removeFeedbackImage:function(a){jQuery("#attach"+a).remove();var c=jQuery("#FeedbackAttachments").val().split(",");c.splice(jQuery.inArray(a,c),1);jQuery("#FeedbackAttachments").val(c.join())}};var m=function(){a(".fb_approve").unbind("click");a(".fb_approve").click(function(){var b=a(this).data();e.confirm(b.confirm,mooConfig.url.base+"/feedbacks/do_active/"+b.id+"/approved/"+b.status)})},n=function(){a(".fb_feature").unbind("click");
a(".fb_feature").click(function(){var b=a(this).data();e.confirm(b.confirm,mooConfig.url.base+"/feedbacks/do_active/"+b.id+"/featured/"+b.status)})},p=function(){a(".fb_delete").unbind("click");a(".fb_delete").click(function(){var b=a(this).data();e.confirm(b.confirm,mooConfig.url.base+"/feedbacks/delete/"+b.id)})},t=function(){a(".fb_vote").unbind("click");a(".fb_vote").click(function(){var b=a(this).attr("ref");jQuery.feedback.vote(b,a(this))});c.initMoreResults()};return{initOnCreate:function(){jQuery.feedback.initFeedbackUploader();
jQuery.feedback.initFeedbackImage()},initOnIndex:function(){l()},initOnView:function(){q()},initShortcut:function(){r()},initOnLoadMore:function(){t()}}});